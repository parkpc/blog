<!DOCTYPE html>
<html>
<head>
    
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>시온고 안드로이드 스터디 노트 - 2.Connect Sunshine to the Cloud | Youngbin Han</title>
  <meta name="description" content="안녕하세요. 저번에 Lesson 1 노트에 이어 이번에 저희 시온고등학교 내 안드로이드 스터디 그룹에서 진도를 나간(부득이하게 온라인으로 나간건 함정…) Lesson 2 내용을 정리하여 포스트로 작성 해 보고자 합니다. Lesson 2 에 대한 정리는… 생각보다 길군요. 바로 들어...">
<!--        Jquery-->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46663268-3', 'auto');
  ga('send', 'pageview');

</script>

<link rel="stylesheet" href="/blog/css/material.min.css">
<link rel="stylesheet" href="/blog/css/font-awesome.min.css">
  <link rel="stylesheet" href="/blog/css/custom.css">
  <link rel="canonical" href="http://sukso96100.github.io//blog/2015/01/01/android-study-lesson-two-note.html">
  <link rel="alternate" type="application/rss+xml" title="Youngbin Han" href="http://sukso96100.github.io//blog/feed.xml" />

<!--Browser Update Notification-->
<script>
var $buoop = {c:2};
function $buo_f(){
 var e = document.createElement("script");
 e.src = "https://browser-update.org/update.js";
 document.body.appendChild(e);
};
try {document.addEventListener("DOMContentLoaded", $buo_f,false)}
catch(e){window.attachEvent("onload", $buo_f)}
</script>

<link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">

    </head>
    <body>

    <div class="demo-layout-transparent mdl-layout mdl-js-layout">
  <header class="mdl-layout__header mdl-layout__header--transparent">
    <div class="mdl-layout__header-row">
      <!-- Title -->
      <span class="mdl-layout-title">Youngbin Han</span>
      <!-- Add spacer, to align navigation to the right -->
      <div class="mdl-layout-spacer"></div>
      <!-- Navigation -->
      <nav class="mdl-navigation">

      </nav>
    </div>
  </header>
  <div class="mdl-layout__drawer">
    <span class="mdl-layout-title">MENU</span>
    <nav class="mdl-navigation">
      <a class="mdl-navigation__link" href="">Link</a>
      <a class="mdl-navigation__link" href="">Link</a>
      <a class="mdl-navigation__link" href="">Link</a>
      <a class="mdl-navigation__link" href="">Link</a>
    </nav>
  </div>
  <main class="mdl-layout__content">
    <div align="center">
    <div class="mdl-card mdl-cell mdl-cell--12-col postcard" align="start">
           <div class="mdl-card__media mdl-color-text--grey-50"
           style="
           padding:16px;">
             <a href="/blog/"><h3 style="color:white;">시온고 안드로이드 스터디 노트 - 2.Connect Sunshine to the Cloud</h3></a>
           </div>
           <section class="content">
           <table><tr><td><i class="material-icons">today</i></td><td>2015.01.01</td></tr></table>
           <hr>
          <p>안녕하세요. 저번에 Lesson 1 노트에 이어 이번에 저희 시온고등학교 내 안드로이드 스터디 그룹에서 진도를 나간(부득이하게 온라인으로 나간건 함정…) Lesson 2 내용을 정리하여 포스트로 작성 해 보고자 합니다. Lesson 2 에 대한 정리는… 생각보다 길군요. 바로 들어가겠습니다.</p>

<h2 id="section">시작하기 앞서…</h2>
<ul>
  <li>Lesson 1 은 공부 하였나요? <a href="http://www.youngbin.tk/2014/12/30/android-study-lesson-one-note.html">안했으면 먼저 하고 오시길.</a></li>
  <li>Lesson 1 에서 작성한 소스코드를 준비하세요.</li>
  <li>매우 당연하게도. 안드로이드 스튜디오가 설치된 컴퓨터를 준비하시길.</li>
  <li>이 포스트에서 다루기는 하겠지만… InputStream, StringBuffer, Thread 는 미리 공부 하고 오시는 것이 좋습니다.</li>
</ul>

<h2 id="lesson-2-">Lesson 2 내용들</h2>
<p>대략 정리하자면 아래와 같습니다</p>

<ul>
  <li>OpenWeatherMap API 를 사용해 날씨정보 얻기</li>
  <li>HttpURLConnection 으로 HttpRequest 보내고 Reponse 받기</li>
  <li>Log 찍기, Logcat 보기</li>
  <li>AsyncTask 를 이용하여 Background Thread 돌리기</li>
  <li>Permission</li>
  <li>JSON 파싱</li>
  <li>Adapter 갱신 + AOSP 소스코드 들여다보기</li>
</ul>

<h2 id="openweathermap-api">OpenWeatherMap API</h2>

<p>이번 Lesson 에서는, OpenWeatherMap 이라는 날씨 정보를 제공하는 사이트에서 제공하는 API 를 이용하여 나리 정보를 불러올 것 입니다.
우리는 일주일 치 날씨 정보를 불러들일 것 입니다. <a href="http://openweathermap.org/forecast">일단 해당 문서를 한번 읽어봅시다.</a></p>

<p><img src="/blogimgs/openweathermap_api_doc.png" /><br /></p>

<p>우리는 도시ID 값으로 특정 도시에 해당되는 날씨를 찾고, 일주일치 일기예보 정보를 얻을 것이며, JSON 형식으로 데이터를 받을 것입니다. 아 그리고 온도 단위는 섭씨로 해야겠죠?</p>

<p>예를 들어서 앞에서 나온 조건을 만족하는 경기도 부천지역 날씨에 해당되는 API의 URL은 어떻게 될까요? 아래와 같습니다.</p>

<p>http://api.openweathermap.org/data/2.5/forecast/daily?id=1838716&amp;units=metric&amp;cnt=7</p>

<ul>
  <li>forecast/daily? - 하루에 대한 일기예보</li>
  <li>id=1838716 - 도시 ID 값(여기서는 부천시 ID 값 사용)</li>
  <li>units=metric - 단위(metric 주로 유럽 국가에서 쓰는 세계 표준 단위 - cm, m, kg … / imperial 미국이나 영국 등ㅇ서 사용하는 단위 - miles, feet …)</li>
  <li>cnt=7 - 일 수(여기서는 7일)</li>
</ul>

<h2 id="httpurlconnection">HttpURLConnection</h2>
<p>날씨 데이터를 얻어낼 URL 도 있으니, 해당 URL 로 부터 데이터를 로드해 봅시다. HttpURLConnection 을 이용해 요청을 보내서 데이터를 얻을 것입니다.
Lesson 1 에서 작성한 소스를 안드로이드 스튜디오 에서 열고. MainActivity.java 의 Fragment 부분에 위치한 onCreateView 부분에서 이어서 작업합시다.</p>

<p>우선 URL 객체를 하나 만듭시다. 그리고 HttpURLConnection 을 이용해 연결하고, 데이터를 로드합시다.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="o">...</span>
<span class="n">HttpURLConnection</span> <span class="n">urlConnection</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">//HttpUrlConnection</span>
<span class="c1">//새 URL 객체</span>
<span class="n">String</span> <span class="n">WeatherURL</span> <span class="o">=</span> <span class="s">"http://api.openweathermap.org/data/2.5/forecast/daily?id=1838716&amp;units=metric&amp;cnt=7"</span><span class="o">;</span>
<span class="n">URL</span> <span class="n">url</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="n">WeatherURL</span><span class="o">);</span> 
<span class="c1">//새 URLConnection</span>
<span class="n">urlConnection</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpURLConnection</span><span class="o">)</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">();</span>
<span class="n">urlConnection</span><span class="o">.</span><span class="na">setRequestMethod</span><span class="o">(</span><span class="s">"GET"</span><span class="o">);</span>
<span class="n">urlConnection</span><span class="o">.</span><span class="na">connect</span><span class="o">();</span>
<span class="o">...</span></code></pre></figure>

<h3 id="section-1">예외 처리</h3>
<p>URL을 다루거나, 데이터를 받아올 때, 예상치 못한 오류에 대비하여 try-catch-finally 를 이용하여 예외처리를 해 봅시다.
try 에 우리가 평상시에 실행할 코드가 들어가고, catch 에는 특정 오류가 잡히면, 실행된 코드들을 넣어주고, finally 에는 try 와 catch 이후 마지막으로 실행될 코드가 들어갑니다.
HttpURLConnection 등의 변수들은, try에사만 사용하지 않고, 그 외의 곳에서도 사용되기에. 예외처리 구문 전에 변수를 선언하고 초기화 해줍시다.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="o">...</span>
<span class="n">HttpURLConnection</span> <span class="n">urlConnection</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">//HttpUrlConnection - try가 아닌 곳에서도 사용 되므로 try 밖에 선언합니다.</span>
<span class="k">try</span> <span class="o">{</span>
        <span class="c1">//새 URL 객체</span>
        <span class="n">String</span> <span class="n">WeatherURL</span> <span class="o">=</span> <span class="s">"http://api.openweathermap.org/data/2.5/forecast/daily?id=1838716&amp;units=metric&amp;cnt=7"</span><span class="o">;</span>
        <span class="n">URL</span> <span class="n">url</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="n">WeatherURL</span><span class="o">);</span> 
        <span class="c1">//새 URLConnection</span>
        <span class="n">urlConnection</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpURLConnection</span><span class="o">)</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">();</span>
        <span class="n">urlConnection</span><span class="o">.</span><span class="na">setRequestMethod</span><span class="o">(</span><span class="s">"GET"</span><span class="o">);</span>
        <span class="n">urlConnection</span><span class="o">.</span><span class="na">connect</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">MalformedURLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
        <span class="o">}</span>
        <span class="o">...</span></code></pre></figure>

<h2 id="inputstream">InputStream</h2>
<p>우리가 수십 리터의 물을 받을 때 어떻게 받나요? 한 손으로 한번에 받나요? 그것을 불가능 합니다. 그 작은 손으로 어떻게 몇 심 리터의 물을 한번에 받겠습니까.
한 손으로 한번에 받지 않고. 도구를 이용해 조금씩 받습니다. 파이프를 연결해서 흘려받는 것을 예로 들 수 있겠군요.
우리가 로드하는 데이터 또한 한번에 로드 할 수 없습니다. 그래서 InputStream 을 이용하여 데이터를 로드합니다. InputStream 은 여러가지 Stream 중 하나 인대.
Stream 은 데이터를 운반 해 주는 통로 역할을 해 줍니다. 물을 흘려보내는 파이프 역할을 한다고 보면 됩니다. Stream 은 연속적인 데이터 흐름을 물에 비유해서 붙여진 이름인대. 물이 한쪽 방향으로만 흐르듯, Stream 은 하나의 방향으로만 통신이 가능해서. 입력/출력을 동시에 처리할 수 없습니다. 그래서 InputStream, OutputStream 이 따로 있습니다. 우리는 데이터를 입력 받으므로. InputStream 을 사용합니다.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="o">...</span>
<span class="n">HttpURLConnection</span> <span class="n">urlConnection</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">//HttpUrlConnection - try가 아닌 곳에서도 사용 되므로 try 밖에 선언합니다.</span>
<span class="k">try</span> <span class="o">{</span>
        <span class="c1">//새 URL 객체</span>
        <span class="n">String</span> <span class="n">WeatherURL</span> <span class="o">=</span> <span class="s">"http://api.openweathermap.org/data/2.5/forecast/daily?id=1838716&amp;units=metric&amp;cnt=7"</span><span class="o">;</span>
        <span class="n">URL</span> <span class="n">url</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="n">WeatherURL</span><span class="o">);</span> 
        <span class="c1">//새 URLConnection</span>
        <span class="n">urlConnection</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpURLConnection</span><span class="o">)</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">();</span>
        <span class="n">urlConnection</span><span class="o">.</span><span class="na">setRequestMethod</span><span class="o">(</span><span class="s">"GET"</span><span class="o">);</span>
        <span class="n">urlConnection</span><span class="o">.</span><span class="na">connect</span><span class="o">();</span>
        <span class="c1">//InputStream 을 사용해 데이터 읽어들이기</span>
        <span class="n">InputStream</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="n">urlConnection</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">MalformedURLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
        <span class="o">}</span>
<span class="o">...</span></code></pre></figure>

<h2 id="stringbuffer">StringBuffer</h2>
<p>StringBuffer 은 문자열인 String 과 매우 유사하지만. 다른 접이 있습니다. String 이 처음에 만들어 질때 저장된 문자열을 바꾸기 어렵지만. StringBuffer 는 쉽게 바꿀 수 있습니다.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="o">...</span>
<span class="n">HttpURLConnection</span> <span class="n">urlConnection</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">//HttpUrlConnection - try가 아닌 곳에서도 사용 되므로 try 밖에 선언합니다.</span>
<span class="n">BufferedReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">//try가 아닌 곳에서도 사용 되므로 try 밖에 선언합니다.</span>
<span class="k">try</span> <span class="o">{</span>
        <span class="c1">//새 URL 객체</span>
        <span class="n">String</span> <span class="n">WeatherURL</span> <span class="o">=</span> <span class="s">"http://api.openweathermap.org/data/2.5/forecast/daily?id=1838716&amp;units=metric&amp;cnt=7"</span><span class="o">;</span>
        <span class="n">URL</span> <span class="n">url</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="n">WeatherURL</span><span class="o">);</span> 
        <span class="c1">//새 URLConnection</span>
        <span class="n">urlConnection</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpURLConnection</span><span class="o">)</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">();</span>
        <span class="n">urlConnection</span><span class="o">.</span><span class="na">setRequestMethod</span><span class="o">(</span><span class="s">"GET"</span><span class="o">);</span>
        <span class="n">urlConnection</span><span class="o">.</span><span class="na">connect</span><span class="o">();</span>
        <span class="c1">//InputStream 을 사용해 데이터 읽어들이기</span>
        <span class="n">InputStream</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="n">urlConnection</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
        <span class="c1">//StringBuffer 에 데이터 저장</span>
        <span class="n">StringBuffer</span> <span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="o">();</span> <span class="c1">// 새로운 StringBuffer 생성</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">inputStream</span><span class="o">));</span>
        <span class="n">String</span> <span class="n">line</span><span class="o">;</span>
            <span class="k">while</span> <span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">buffer</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">line</span> <span class="o">+</span> <span class="s">"\n"</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">MalformedURLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
        <span class="o">}</span>
<span class="o">...</span></code></pre></figure>

<h2 id="section-2">불러온 데이터 문자열 변수에 저장. 오류 예외처리</h2>
<p>이제 불러온 데이터는 String 형태의 변수에 저장하고. 위에서 미리 작성한 예외처리에서, catch 부분에 오류 발생시 실행될 코드를 넣어줍니다.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="o">...</span>
<span class="n">HttpURLConnection</span> <span class="n">urlConnection</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">//HttpUrlConnection</span>
<span class="n">BufferedReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">//try가 아닌 곳에서도 사용 되므로 try 밖에 선언합니다.</span>
<span class="n">String</span> <span class="n">forecastJsonStr</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">//불러온 데이터 저장에 사용할 변수 - try가 아닌 곳에서도 사용 되므로 try 밖에 선언합니다.</span>
<span class="k">try</span><span class="o">{</span>
    <span class="c1">//새 URL 객체</span>
    <span class="n">String</span> <span class="n">WeatherURL</span> <span class="o">=</span> <span class="s">"http://api.openweathermap.org/data/2.5/forecast/daily?id=1838716&amp;units=metric&amp;cnt=7"</span><span class="o">;</span>
    <span class="n">URL</span> <span class="n">url</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="n">WeatherURL</span><span class="o">);</span> 
    <span class="c1">//새 URLConnection</span>
    <span class="n">urlConnection</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpURLConnection</span><span class="o">)</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">();</span>
    <span class="n">urlConnection</span><span class="o">.</span><span class="na">setRequestMethod</span><span class="o">(</span><span class="s">"GET"</span><span class="o">);</span>
    <span class="n">urlConnection</span><span class="o">.</span><span class="na">connect</span><span class="o">();</span>
    <span class="c1">//InputStream 을 사용해 데이터 읽어들이기</span>
    <span class="n">InputStream</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="n">urlConnection</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
    <span class="c1">//StringBuffer 에 데이터 저장</span>
    <span class="n">StringBuffer</span> <span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="o">();</span> <span class="c1">// 새로운 StringBuffer 생성</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">inputStream</span><span class="o">));</span>
    <span class="n">String</span> <span class="n">line</span><span class="o">;</span>
    <span class="k">while</span> <span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">buffer</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">line</span> <span class="o">+</span> <span class="s">"\n"</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">buffer</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 불러온 데이터가 비어있음.</span>
        <span class="n">forecastJsonStr</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">forecastJsonStr</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span> <span class="c1">//로드한 데이터 문자열 변수에 저장.</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">MalformedURLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">){</span>
        <span class="n">forecastJsonStr</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">finally</span><span class="o">{</span>
             <span class="k">if</span> <span class="o">(</span><span class="n">urlConnection</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">urlConnection</span><span class="o">.</span><span class="na">disconnect</span><span class="o">();</span> <span class="c1">//HttpURLConnection 연결 끊기</span>
            <span class="o">}</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">reader</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="n">reader</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="kd">final</span> <span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
<span class="o">...</span></code></pre></figure>

<h2 id="log-">Log 찍기</h2>
<p>오류가 나는 경우 그에 대한 더 자세한 정보를 얻기 위해. Log 가 찍히도록 코드를 작성해 봅시다. 아래와 같은 형태의 Log 를 찍을 수 있습니다.</p>

<ul>
  <li>Error(오류)</li>
  <li>Warn(경고)</li>
  <li>Info(정보)</li>
  <li>Debug(디버그)</li>
  <li>Verbose(일반적인 정보)</li>
</ul>

<p>아래와 같은 코드로 Log 를 찍을 수 있습니다.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">"로그"</span><span class="o">,</span> <span class="s">"오류 발생"</span><span class="o">);</span> 
<span class="n">Log</span><span class="o">.</span><span class="na">w</span><span class="o">(</span><span class="s">"로그"</span><span class="o">,</span> <span class="s">"경고!"</span><span class="o">);</span> 
<span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="s">"로그"</span><span class="o">,</span> <span class="s">"새로운 정보!"</span><span class="o">);</span> 
<span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"로그"</span><span class="o">,</span> <span class="s">"디버깅 결과"</span><span class="o">);</span> 
<span class="n">Log</span><span class="o">.</span><span class="na">v</span><span class="o">(</span><span class="s">"로그"</span><span class="o">,</span> <span class="s">"일반적인 정보"</span><span class="o">);</span></code></pre></figure>

<h2 id="logcat-">Logcat 보기</h2>
<p>여기까지 작성한 앱을 한번 실행 해 봅시다. 앱이 강제 종료 되지 않나요? 그것이 정상 입니다. Logcat을 확인해서 출력된 Log들을 살펴 봅시다.
<img src="/blogimgs/networkonmain.png" /><br /></p>

<p>보통, Run 버튼을 눌러 앱을 테스트 하면, 자동으로 하단에 Android DDMS 가 나타나고, 그곳에 Logcat 이 나타납니다. Run 버튼과 같은 줄에 위치한 Android Device Monitor(안드로이드 마스코드 모양의 버튼)에서도 Logcat 확인이 가능합니다. 
<img src="/blogimgs/check_logcat.png" /><br /></p>

<p>Logcat 을 한번 확인 해 봅시다.</p>
<pre>
01-02 00:01:33.119    4099-4099/com.youngbin.androidstudy D/AndroidRuntime﹕ Shutting down VM
01-02 00:01:33.127    4099-4099/com.youngbin.androidstudy E/AndroidRuntime﹕ FATAL EXCEPTION: main
    Process: com.youngbin.androidstudy, PID: 4099
    java.lang.RuntimeException: Unable to start activity ComponentInfo{com.youngbin.androidstudy/com.youngbin.androidstudy.MainActivity}: android.os.NetworkOnMainThreadException
            at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2298)
            at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:2360)
            at android.app.ActivityThread.access$800(ActivityThread.java:144)
            at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1278)
            at android.os.Handler.dispatchMessage(Handler.java:102)
            at android.os.Looper.loop(Looper.java:135)
            at android.app.ActivityThread.main(ActivityThread.java:5221)
            at java.lang.reflect.Method.invoke(Native Method)
            at java.lang.reflect.Method.invoke(Method.java:372)
            at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:899)
            at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:694)
     Caused by: android.os.NetworkOnMainThreadException
            at android.os.StrictMode$AndroidBlockGuardPolicy.onNetwork(StrictMode.java:1147)
            at java.net.InetAddress.lookupHostByName(InetAddress.java:418)
            at java.net.InetAddress.getAllByNameImpl(InetAddress.java:252)
            at java.net.InetAddress.getAllByName(InetAddress.java:215)
            at com.android.okhttp.HostResolver$1.getAllByName(HostResolver.java:29)
            at com.android.okhttp.internal.http.RouteSelector.resetNextInetSocketAddress(RouteSelector.java:232)
            at com.android.okhttp.internal.http.RouteSelector.next(RouteSelector.java:124)
            at com.android.okhttp.internal.http.HttpEngine.connect(HttpEngine.java:272)
            at com.android.okhttp.internal.http.HttpEngine.sendRequest(HttpEngine.java:211)
            at com.android.okhttp.internal.http.HttpURLConnectionImpl.execute(HttpURLConnectionImpl.java:373)
            at com.android.okhttp.internal.http.HttpURLConnectionImpl.connect(HttpURLConnectionImpl.java:106)
            at com.youngbin.androidstudy.MainActivity$PlaceholderFragment.onCreateView(MainActivity.java:94)
            at android.support.v4.app.Fragment.performCreateView(Fragment.java:1786)
            at android.support.v4.app.FragmentManagerImpl.moveToState(FragmentManager.java:947)
            at android.support.v4.app.FragmentManagerImpl.moveToState(FragmentManager.java:1126)
            at android.support.v4.app.BackStackRecord.run(BackStackRecord.java:739)
            at android.support.v4.app.FragmentManagerImpl.execPendingActions(FragmentManager.java:1489)
            at android.support.v4.app.FragmentActivity.onStart(FragmentActivity.java:548)
            at android.app.Instrumentation.callActivityOnStart(Instrumentation.java:1220)
            at android.app.Activity.performStart(Activity.java:5949)
            at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2261)
            at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:2360)
            at android.app.ActivityThread.access$800(ActivityThread.java:144)
            at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1278)
            at android.os.Handler.dispatchMessage(Handler.java:102)
            at android.os.Looper.loop(Looper.java:135)
            at android.app.ActivityThread.main(ActivityThread.java:5221)
            at java.lang.reflect.Method.invoke(Native Method)
            at java.lang.reflect.Method.invoke(Method.java:372)
            at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:899)
            at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:694)
</pre>

<p>우리가 작성한 코드의 네트워크 통신 부분에서 오류가 발생했군요. NetworkOnMainThreadException 오류가 발생했습니다. 우리가 네트워크 작업이 Main Thread 에서 실행되도록 작성해서 그렇습니다. 이를 해결하기 위해, Thread 에 대해서 알아봅시다.</p>
<pre>
    ...
    Process: com.youngbin.androidstudy, PID: 4099
    java.lang.RuntimeException: Unable to start activity ComponentInfo{com.youngbin.androidstudy/com.youngbin.androidstudy.MainActivity}: android.os.NetworkOnMainThreadException
            at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2298)
            ...
            at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:694)
     Caused by: android.os.NetworkOnMainThreadException
            at android.os.StrictMode$AndroidBlockGuardPolicy.onNetwork(StrictMode.java:1147)
            ...
            at com.android.okhttp.internal.http.HttpURLConnectionImpl.connect(HttpURLConnectionImpl.java:106)
            at com.youngbin.androidstudy.MainActivity$PlaceholderFragment.onCreateView(MainActivity.java:94)
            at android.support.v4.app.Fragment.performCreateView(Fragment.java:1786)
            at android.support.v4.app.FragmentManagerImpl.moveToState(FragmentManager.java:947)
            ...
</pre>

<h2 id="thread">Thread</h2>
<p>어떤 프로그램 또는 프로세스 내부에서 실행이 되는 흐름의 단위를 말합니다. 필요에 따하 둘 이상의 Thread 를 실행 시킬수도 있는대 이러한 실행 방식을 Multithread 하며, 둘 이상의 Thread 를 다루는 것을 보고, MultiThreading 이라고 합니다. 안드로이드 앱 에서는 기본적으로 사용자로 부터의 입력 및 출력을 처리해 주는 UI Thread 가 있습니다. Main Thread 라고도 부릅니다. UI Thread 는 버튼 클릭, 화면 드래그 등의 간단하고 짧은 작업들을 수행합니다. 그런대 여기서 네트워크 작업을 실행하게 되면. 네트워크 작업을 일단 마쳐야 하기 때문에, 만약 네트워크 작업이 오래 걸리면 사용자로 부터의 입력과 출력 등을 처리하지 못하게 됩니다. 사용자 입장에서는 앱이 먹통인 것으로 보입니다. 그러므로 안드로이드 3.0 부터는 이렇게 작동되면 오류로 처리가 되어 버립니다. 우리는 네트워크 작업을 별도 Thread 에서 실행되도록 할 건대. AsyncTask 를 이용하여 구현 할 것입니다.
<img src="/blogimgs/multithreading.png" /><br /></p>

<h2 id="asynctask">AsyncTask</h2>
<p>AsyncTask 는 백그라운드 작업을 쉽게 실행 할 수 있도록, 그리고 결과를 UI Thread 로 쉽게 넘길 수 있도록 해줍니다.
AsyncTask 에는 4가지 메서드가 있습니다. 백그라운드 작업 전에 실행되는 onPreExecute(), 백그라운드 작업을 실행하는 doInBackground(Params…), 중간에 진행 정도를 UI Thread 에 넘겨주는 onProgressUpdate(Progress…), 백그라운드 작업이 끝나고 실행되며 결과를 Ui Thread 로 넘기는 onPostExecute(Result) 가 있습니다. 
<img src="/blogimgs/asynctask_methods.png" /><br /></p>

<p>AsyncTask 를 구현 할 때는, AsncTask 를 상속받는 클래스로 구현합니다.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kd">class</span> <span class="nc">myAsyncTask</span> <span class="kd">extends</span> <span class="n">AsyncTask</span><span class="o">&lt;</span><span class="err">실행시</span> <span class="err">받을</span> <span class="err">매개변수</span> <span class="err">타입</span><span class="o">,</span> <span class="err">진행</span> <span class="err">현황</span> <span class="err">변수</span> <span class="err">타입</span><span class="o">,</span> <span class="err">완료시</span> <span class="err">반환할</span> <span class="err">변수</span> <span class="err">타입</span><span class="o">&gt;{</span> 
    <span class="kd">protected</span> <span class="kt">void</span> <span class="n">onPreExecute</span><span class="o">()</span> <span class="o">{</span> 
    <span class="c1">// 백그라운드 작업 전에 Main Thread 에 실행 </span>
        <span class="o">}</span> 
    <span class="kd">protected</span> <span class="kt">void</span> <span class="n">doInBackground</span><span class="o">(</span><span class="n">Params</span><span class="o">...</span> <span class="n">params</span><span class="o">)</span> <span class="o">{</span> 
    <span class="c1">//백그라운드 작업 실행 </span>
    <span class="o">}</span> 
    <span class="kd">protected</span> <span class="kt">void</span> <span class="n">onProgressUpdate</span><span class="o">(</span><span class="n">Progress</span><span class="o">...</span> <span class="n">progress</span><span class="o">)</span> <span class="o">{</span> 
    <span class="c1">//도중에 진행 정도 변경 시 Main Thread 에서 실행 </span>
    <span class="n">publishProgress</span><span class="o">(</span><span class="n">progress</span><span class="o">);</span> 
        <span class="o">}</span> 
    <span class="kd">protected</span> <span class="kt">void</span> <span class="n">onPostExecute</span><span class="o">(</span><span class="n">Result</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span> 
    <span class="c1">//백그라운드 작업 후 Main Thread 실행 </span>
        <span class="o">}</span>
    <span class="o">}</span></code></pre></figure>

<p>그럼, 한번 구현해 봅시다. 일단 코드가 슬슬 길어져서 눈으로 읽이 좀 어려우니. Fragment 를 별도의 클래스 파일로 분리합니다.
새로 클래스 파일을 만들고, 그곳으로 Fragment 부분을 모두 옮기고, 기존에 Activity 클래스 파일의 Fragment 코드는 지웁시다.</p>

<p>수정된 MainActivity,java</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">ActionBarActivity</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="n">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">savedInstanceState</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">getSupportFragmentManager</span><span class="o">().</span><span class="na">beginTransaction</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">container</span><span class="o">,</span> <span class="k">new</span> <span class="n">WeatherFragment</span><span class="o">())</span>
                    <span class="o">.</span><span class="na">commit</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="o">...</span></code></pre></figure>

<p>MainActivity.java 에서 WeatherFragment.java 로 분리된 Fragment 코드</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">WeatherFragment</span> <span class="kd">extends</span> <span class="n">Fragment</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">WeatherFragment</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">View</span> <span class="n">onCreateView</span><span class="o">(</span><span class="n">LayoutInflater</span> <span class="n">inflater</span><span class="o">,</span> <span class="n">ViewGroup</span> <span class="n">container</span><span class="o">,</span>
                             <span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">View</span> <span class="n">rootView</span> <span class="o">=</span> <span class="n">inflater</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">fragment_main</span><span class="o">,</span> <span class="n">container</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="c1">//문자열 배열로 ListView에 넣을 데이터 만들기. 이름은 myArray.</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">myArray</span> <span class="o">=</span> <span class="o">{</span><span class="s">"Sample Item 0"</span><span class="o">,</span> <span class="s">"Sample Item 1"</span><span class="o">,</span> <span class="s">"Sample Item 2"</span><span class="o">,</span> <span class="s">"Sample Item 3"</span><span class="o">,</span> <span class="s">"Sample Item 4"</span><span class="o">};</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">myArrayList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">myArray</span><span class="o">));</span> <span class="c1">//ArrayList로 변환합니다. 동적으로 항목을 추가하거나 뺄 수 있습니다.</span>
        <span class="c1">//ArrayAdapter 초기화</span>
        <span class="n">ArrayAdapter</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">myAdapter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayAdapter</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span>
                <span class="n">getActivity</span><span class="o">(),</span> <span class="c1">//Context - Fragment 는 Context 를 가지지 않으므로 Activity 에서 얻어옴</span>
                <span class="n">android</span><span class="o">.</span><span class="na">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">simple_list_item_1</span><span class="o">,</span> <span class="c1">//각 항목별 Layout - 일단은 안드로이드 시스템 내장 리소스 얻어옴</span>
                <span class="n">myArrayList</span><span class="o">);</span> <span class="c1">//ListView 에 표시될 데이터</span>
        <span class="c1">//ListView 찾기</span>
        <span class="n">ListView</span> <span class="n">LV</span> <span class="o">=</span> <span class="o">(</span><span class="n">ListView</span><span class="o">)</span><span class="n">rootView</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">listView</span><span class="o">);</span> <span class="c1">//R.id.(ListView id 값 - Layout 파일에서 확인 가능)</span>
        <span class="c1">//Adapter 설정</span>
        <span class="n">LV</span><span class="o">.</span><span class="na">setAdapter</span><span class="o">(</span><span class="n">myAdapter</span><span class="o">);</span>

        <span class="n">HttpURLConnection</span> <span class="n">urlConnection</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">//HttpUrlConnection</span>
        <span class="n">BufferedReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">//try가 아닌 곳에서도 사용 되므로 try 밖에 선언합니다.</span>
        <span class="n">String</span> <span class="n">forecastJsonStr</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">//불러온 데이터 저장에 사용할 변수 - try가 아닌 곳에서도 사용 되므로 try 밖에 선언합니다.</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="c1">//새 URL 객체</span>
            <span class="n">String</span> <span class="n">WeatherURL</span> <span class="o">=</span> <span class="s">"http://api.openweathermap.org/data/2.5/forecast/daily?id=1838716&amp;units=metric&amp;cnt=7"</span><span class="o">;</span>
            <span class="n">URL</span> <span class="n">url</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="n">WeatherURL</span><span class="o">);</span>
            <span class="c1">//새 URLConnection</span>
            <span class="n">urlConnection</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpURLConnection</span><span class="o">)</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">();</span>
            <span class="n">urlConnection</span><span class="o">.</span><span class="na">setRequestMethod</span><span class="o">(</span><span class="s">"GET"</span><span class="o">);</span>
            <span class="n">urlConnection</span><span class="o">.</span><span class="na">connect</span><span class="o">();</span>
            <span class="c1">//InputStream 을 사용해 데이터 읽어들이기</span>
            <span class="n">InputStream</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="n">urlConnection</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
            <span class="c1">//StringBuffer 에 데이터 저장</span>
            <span class="n">StringBuffer</span> <span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="o">();</span> <span class="c1">// 새로운 StringBuffer 생성</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">inputStream</span><span class="o">));</span>
            <span class="n">String</span> <span class="n">line</span><span class="o">;</span>
            <span class="k">while</span> <span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">buffer</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">line</span> <span class="o">+</span> <span class="s">"\n"</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">buffer</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// 불러온 데이터가 비어있음.</span>
                <span class="n">forecastJsonStr</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="n">forecastJsonStr</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span> <span class="c1">//로드한 데이터 문자열 변수에 저장.</span>
        <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">){</span>
            <span class="n">forecastJsonStr</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span><span class="k">finally</span><span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">urlConnection</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">urlConnection</span><span class="o">.</span><span class="na">disconnect</span><span class="o">();</span> <span class="c1">//HttpURLConnection 연결 끊기</span>
            <span class="o">}</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">reader</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="n">reader</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="kd">final</span> <span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">rootView</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>일단은, doInBackground() 만 구현해 봅시다. AsyncTask 를 상속하는 내부 클래스를 하나 만들고 doImBackgound() 를 구현한 다음, 그 안에 네트워크 작업 코드를 옮기면 됩니다.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">WeatherFragment</span> <span class="kd">extends</span> <span class="n">Fragment</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">WeatherFragment</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">View</span> <span class="n">onCreateView</span><span class="o">(</span><span class="n">LayoutInflater</span> <span class="n">inflater</span><span class="o">,</span> <span class="n">ViewGroup</span> <span class="n">container</span><span class="o">,</span>
                             <span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">View</span> <span class="n">rootView</span> <span class="o">=</span> <span class="n">inflater</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">fragment_main</span><span class="o">,</span> <span class="n">container</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="o">...</span>
        <span class="n">myAsyncTask</span> <span class="n">mat</span> <span class="o">=</span> <span class="k">new</span> <span class="n">myAsyncTask</span><span class="o">();</span> <span class="c1">//myAsyncTask 객체 생성</span>
        <span class="n">mat</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span> <span class="c1">//myAsyncTask 실행하기</span>
        <span class="k">return</span> <span class="n">rootView</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">protected</span> <span class="kd">class</span> <span class="nc">myAsyncTask</span> <span class="kd">extends</span> <span class="n">AsyncTask</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">,</span> <span class="n">Void</span><span class="o">,</span> <span class="n">Void</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="n">Void</span> <span class="n">doInBackground</span><span class="o">(</span><span class="n">Void</span><span class="o">...</span> <span class="n">params</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">HttpURLConnection</span> <span class="n">urlConnection</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">//HttpUrlConnection</span>
            <span class="n">BufferedReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">//try가 아닌 곳에서도 사용 되므로 try 밖에 선언합니다.</span>
            <span class="n">String</span> <span class="n">forecastJsonStr</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">//불러온 데이터 저장에 사용할 변수 - try가 아닌 곳에서도 사용 되므로 try 밖에 선언합니다.</span>
            <span class="k">try</span><span class="o">{</span>
                <span class="c1">//새 URL 객체</span>
                <span class="n">String</span> <span class="n">WeatherURL</span> <span class="o">=</span> <span class="s">"http://api.openweathermap.org/data/2.5/forecast/daily?id=1838716&amp;units=metric&amp;cnt=7"</span><span class="o">;</span>
                <span class="n">URL</span> <span class="n">url</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="n">WeatherURL</span><span class="o">);</span>
                <span class="c1">//새 URLConnection</span>
                <span class="n">urlConnection</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpURLConnection</span><span class="o">)</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">();</span>
                <span class="n">urlConnection</span><span class="o">.</span><span class="na">setRequestMethod</span><span class="o">(</span><span class="s">"GET"</span><span class="o">);</span>
                <span class="n">urlConnection</span><span class="o">.</span><span class="na">connect</span><span class="o">();</span>
                <span class="c1">//InputStream 을 사용해 데이터 읽어들이기</span>
                <span class="n">InputStream</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="n">urlConnection</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
                <span class="c1">//StringBuffer 에 데이터 저장</span>
                <span class="n">StringBuffer</span> <span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="o">();</span> <span class="c1">// 새로운 StringBuffer 생성</span>
                <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">inputStream</span><span class="o">));</span>
                <span class="n">String</span> <span class="n">line</span><span class="o">;</span>
                <span class="k">while</span> <span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">buffer</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">line</span> <span class="o">+</span> <span class="s">"\n"</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">buffer</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="c1">// 불러온 데이터가 비어있음.</span>
                    <span class="n">forecastJsonStr</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="n">forecastJsonStr</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span> <span class="c1">//로드한 데이터 문자열 변수에 저장.</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">MalformedURLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">){</span>
                <span class="n">forecastJsonStr</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span><span class="k">finally</span><span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">urlConnection</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">urlConnection</span><span class="o">.</span><span class="na">disconnect</span><span class="o">();</span> <span class="c1">//HttpURLConnection 연결 끊기</span>
                <span class="o">}</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">reader</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">try</span> <span class="o">{</span>
                        <span class="n">reader</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="kd">final</span> <span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h2 id="overflow-menu">Overflow Menu</h2>
<p>매번 네트워크 작업이 잘 실행되는지 보기 위해 앱을 죽이고 다시 실행하기는 번거롭습니다. Overflow Menu 를 만들어, 그곳에 새로고침 메뉴를 넣어 봅시다.
아래 사진이 Overflow Menu 입니다. 안드로이드 디바이스에서 다양한 앱 들을 사용 하시면서, 많이 보셨을 겁니다.
<img src="/blogimgs/overflow_menu.png" /><br /></p>

<h3 id="xml--overflow-menu-">xml 파일로 Overflow Menu 정의하기</h3>
<p>우선, Overflow Menu 에 어떤 항목을 넣을지, xml 항목으로 정의 해 줘야 합니다. 먼저, 새로고침 항목에 쓸 문자열을 /res/values/strings.xml 에 추가 합시다.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;resources&gt;</span>
    ...
    <span class="c">&lt;!--새로 추가한 문자열--&gt;</span>
    <span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">"refresh"</span><span class="nt">&gt;</span>Refresh<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;/resources&gt;</span></code></pre></figure>

<p>그 다음, 메뉴 항목을 정의해 줍시다. 새로 메뉴 리소스 파일을 /res/menu/ 에 생성해 주세요. 저는 /res/menu/weatherfragment.xml 파일을 생성 했습니다.
그리고 아래 코드를 참고하여, 메뉴를 정의해 주세요.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;menu</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">xmlns:app=</span><span class="s">"http://schemas.android.com/apk/res-auto"</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- 각 메뉴 항목은 item 태그로 정의합니다.
       android:id="@+id/action_refresh" 항목의 id 값 - 여기서는 action_refresh
       android:title="@string/refresh" 메뉴 항목에 표시할 텍스트
       android:orderInCategory="100" Overflow Menu 에서 몇 번째로 보일지 지정. 여기서는 100번째
       app:showAsAction="never" 액션메뉴 버튼으로 보일지 여부. ifRoom 으로 하면 공간이 있을때,
           Oveeflow Menu 버튼 옆에 별도 버튼으로. never 로 하면 Overflow Menu 에만 나타남.--&gt;</span>
    <span class="nt">&lt;item</span> <span class="na">android:id=</span><span class="s">"@+id/action_refresh"</span> <span class="na">android:title=</span><span class="s">"@string/refresh"</span>
        <span class="na">android:orderInCategory=</span><span class="s">"100"</span> <span class="na">app:showAsAction=</span><span class="s">"never"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/menu&gt;</span></code></pre></figure>

<p>이제, WeatherFragment.java (아까 MainActivity.java 에서 별도 클래스 파일로 분리된 Fragment 클래스 파일) 을 열고, Overflow Menu 동작을 처리해 줍시다.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">WeatherFragment</span> <span class="kd">extends</span> <span class="n">Fragment</span> <span class="o">{</span>
<span class="o">...</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onCreateOptionsMenu</span><span class="o">(</span><span class="n">Menu</span> <span class="n">menu</span><span class="o">,</span> <span class="n">MenuInflater</span> <span class="n">inflater</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 정의한 Menu 리소스를 여기서 Inflate 합니다.</span>
        <span class="n">inflater</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">menu</span><span class="o">.</span><span class="na">weatherfragment</span><span class="o">,</span> <span class="n">menu</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">onOptionsItemSelected</span><span class="o">(</span><span class="n">MenuItem</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 메뉴 항목 클릭을 여기서 처리합니다..</span>
        <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="na">getItemId</span><span class="o">();</span> <span class="c1">// 클릭된 항목 id 값 얻기</span>

        <span class="c1">//얻은 id 값에 따라 클릭 처리</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">action_refresh</span><span class="o">)</span> <span class="o">{</span> <span class="c1">//id값이 action_refresh 이면.</span>
            <span class="c1">// 네트워크 작업 실행</span>
            <span class="n">myAsyncTask</span> <span class="n">mat</span> <span class="o">=</span> <span class="k">new</span> <span class="n">myAsyncTask</span><span class="o">();</span> <span class="c1">//myAsyncTask 객체 생성</span>
            <span class="n">mat</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span> <span class="c1">//myAsyncTask 실행하기</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">onOptionsItemSelected</span><span class="o">(</span><span class="n">item</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>아. 그리고 WeatherFragment 가 Overflow Menu 를 가지고 있음을 MainActivity 에 알려서, WeatherFragment 가 가지고 있는 Overflow Menu 를 표시 하도록 해 줍시다.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">WeatherFragment</span> <span class="kd">extends</span> <span class="n">Fragment</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">WeatherFragment</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">View</span> <span class="n">onCreateView</span><span class="o">(</span><span class="n">LayoutInflater</span> <span class="n">inflater</span><span class="o">,</span> <span class="n">ViewGroup</span> <span class="n">container</span><span class="o">,</span>
                             <span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">View</span> <span class="n">rootView</span> <span class="o">=</span> <span class="n">inflater</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">fragment_main</span><span class="o">,</span> <span class="n">container</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="o">...</span>
        <span class="c1">// 이 Fragment 가 Overflow Menu 를 가지고 있음을 알리기.</span>
        <span class="n">setHasOptionsMenu</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="o">...</span>
        <span class="k">return</span> <span class="n">rootView</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="o">...</span>
<span class="o">}</span></code></pre></figure>

<p>이제 앱을 다시 한번 실행 해 보세요. 앱이 잘 실행 되나요? 여전히 오류가 날 것입니다. 그것이 정상입니다. Logcat 을 한번 확인 해 볼까요?</p>
<pre>
01-02 11:18:54.040  16366-16387/com.youngbin.androidstudy E/AndroidRuntime﹕ FATAL EXCEPTION: AsyncTask #1
    Process: com.youngbin.androidstudy, PID: 16366
    java.lang.RuntimeException: An error occured while executing doInBackground()
            at android.os.AsyncTask$3.done(AsyncTask.java:300)
            at java.util.concurrent.FutureTask.finishCompletion(FutureTask.java:355)
            at java.util.concurrent.FutureTask.setException(FutureTask.java:222)
            at java.util.concurrent.FutureTask.run(FutureTask.java:242)
            at android.os.AsyncTask$SerialExecutor$1.run(AsyncTask.java:231)
            at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1112)
            at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)
            at java.lang.Thread.run(Thread.java:818)
     Caused by: java.lang.SecurityException: Permission denied (missing INTERNET permission?)
            at java.net.InetAddress.lookupHostByName(InetAddress.java:451)
            at java.net.InetAddress.getAllByNameImpl(InetAddress.java:252)
            at java.net.InetAddress.getAllByName(InetAddress.java:215)
            at com.android.okhttp.HostResolver$1.getAllByName(HostResolver.java:29)
            at com.android.okhttp.internal.http.RouteSelector.resetNextInetSocketAddress(RouteSelector.java:232)
            at com.android.okhttp.internal.http.RouteSelector.next(RouteSelector.java:124)
            at com.android.okhttp.internal.http.HttpEngine.connect(HttpEngine.java:272)
            at com.android.okhttp.internal.http.HttpEngine.sendRequest(HttpEngine.java:211)
            at com.android.okhttp.internal.http.HttpURLConnectionImpl.execute(HttpURLConnectionImpl.java:373)
            at com.android.okhttp.internal.http.HttpURLConnectionImpl.connect(HttpURLConnectionImpl.java:106)
            at com.youngbin.androidstudy.WeatherFragment$myAsyncTask.doInBackground(WeatherFragment.java:66)
            at com.youngbin.androidstudy.WeatherFragment$myAsyncTask.doInBackground(WeatherFragment.java:53)
            at android.os.AsyncTask$2.call(AsyncTask.java:288)
            at java.util.concurrent.FutureTask.run(FutureTask.java:237)
            at android.os.AsyncTask$SerialExecutor$1.run(AsyncTask.java:231)
            at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1112)
            at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)
            at java.lang.Thread.run(Thread.java:818)
     Caused by: android.system.GaiException: android_getaddrinfo failed: EAI_NODATA (No address associated with hostname)
            at libcore.io.Posix.android_getaddrinfo(Native Method)
            at libcore.io.ForwardingOs.android_getaddrinfo(ForwardingOs.java:55)
            at java.net.InetAddress.lookupHostByName(InetAddress.java:438)
            at java.net.InetAddress.getAllByNameImpl(InetAddress.java:252)
            at java.net.InetAddress.getAllByName(InetAddress.java:215)
            at com.android.okhttp.HostResolver$1.getAllByName(HostResolver.java:29)
            at com.android.okhttp.internal.http.RouteSelector.resetNextInetSocketAddress(RouteSelector.java:232)
            at com.android.okhttp.internal.http.RouteSelector.next(RouteSelector.java:124)
            at com.android.okhttp.internal.http.HttpEngine.connect(HttpEngine.java:272)
            at com.android.okhttp.internal.http.HttpEngine.sendRequest(HttpEngine.java:211)
            at com.android.okhttp.internal.http.HttpURLConnectionImpl.execute(HttpURLConnectionImpl.java:373)
            at com.android.okhttp.internal.http.HttpURLConnectionImpl.connect(HttpURLConnectionImpl.java:106)
            at com.youngbin.androidstudy.WeatherFragment$myAsyncTask.doInBackground(WeatherFragment.java:66)
            at com.youngbin.androidstudy.WeatherFragment$myAsyncTask.doInBackground(WeatherFragment.java:53)
            at android.os.AsyncTask$2.call(AsyncTask.java:288)
            at java.util.concurrent.FutureTask.run(FutureTask.java:237)
            at android.os.AsyncTask$SerialExecutor$1.run(AsyncTask.java:231)
            at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1112)
            at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)
            at java.lang.Thread.run(Thread.java:818)
     Caused by: android.system.ErrnoException: android_getaddrinfo failed: EACCES (Permission denied)
            at libcore.io.Posix.android_getaddrinfo(Native Method)
            at libcore.io.ForwardingOs.android_getaddrinfo(ForwardingOs.java:55)
            at java.net.InetAddress.lookupHostByName(InetAddress.java:438)
            at java.net.InetAddress.getAllByNameImpl(InetAddress.java:252)
            at java.net.InetAddress.getAllByName(InetAddress.java:215)
            at com.android.okhttp.HostResolver$1.getAllByName(HostResolver.java:29)
            at com.android.okhttp.internal.http.RouteSelector.resetNextInetSocketAddress(RouteSelector.java:232)
            at com.android.okhttp.internal.http.RouteSelector.next(RouteSelector.java:124)
            at com.android.okhttp.internal.http.HttpEngine.connect(HttpEngine.java:272)
            at com.android.okhttp.internal.http.HttpEngine.sendRequest(HttpEngine.java:211)
            at com.android.okhttp.internal.http.HttpURLConnectionImpl.execute(HttpURLConnectionImpl.java:373)
            at com.android.okhttp.internal.http.HttpURLConnectionImpl.connect(HttpURLConnectionImpl.java:106)
            at com.youngbin.androidstudy.WeatherFragment$myAsyncTask.doInBackground(WeatherFragment.java:66)
            at com.youngbin.androidstudy.WeatherFragment$myAsyncTask.doInBackground(WeatherFragment.java:53)
            at android.os.AsyncTask$2.call(AsyncTask.java:288)
            at java.util.concurrent.FutureTask.run(FutureTask.java:237)
            at android.os.AsyncTask$SerialExecutor$1.run(AsyncTask.java:231)
            at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1112)
            at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)
            at java.lang.Thread.run(Thread.java:818)
</pre>

<p>Logcat 에서 이 부분에 주목해 주세요. 이번에는 SecurityException 때문에 앱이 종료 되었군요. 앱이 인터넷 권한(Permission)을 가지고 있지 않아서 그렇습니다.
문제를 해결하기 위해, 우선 안드로이드의 Permission 시스템에 대해 알아보고, Manifest 에 인터넷 권한도 정의 해 봅시다.</p>
<pre>
            ...
            at java.lang.Thread.run(Thread.java:818)
     Caused by: java.lang.SecurityException: Permission denied (missing INTERNET permission?)
            at java.net.InetAddress.lookupHostByName(InetAddress.java:451)
            ...
</pre>

<h2 id="permission">Permission</h2>
<p>안드로이드 에서 각각의 앱 들은 설치가 될 때 그 앱 만의 고유한 리눅스 사용자 ID 를 부여 받습니다. 그리고 각 앱들은 안드로이드 가상 머신 안의 각 앱의 인스턴스 안에서 실행 됩니다.
결과적으로, 각 앱들은 각각의 보호된 영역에 완전히 갇혀 실행 되게 됩니다. 또한 외부로 부터 영향을 받지 않으며, 내부에서도 외부에 영향을 주지 못합니다.</p>

<p>이러한 형태의 보안 모델을 샌드박스(Sandbox) 라고 하며, 다시 말해 안드로이드 에서 각 앱들은 별도의 샌드박스 에서 실행 됩니다. 이로 인해 각 앱들은 다른 앱의 리소스나 프로세스에 접근 할 수 없게 됩니다. 또한 그 어떤 앱도 다른 앱, 안드로이드 OS, 또는 사용자에게 영향을 주는 민감한 데이터 접근하는 것 이나, 민감한 작업을 실행하는 것들을 못하도록 해 줍니다.</p>

<p>인터넷을 사용하는 것, 사용자 위치 정보 얻기, 주소록 데이터 수정하기, 메시지 보내기 등을 예로 들 수 있습니다. 이러한 민감한 것들을 앱에서 하고자 할때, 매번 일일이 권한(Permission) 을 요청 하기 보다는. 개발자가 앱에 요구되는 권한을 Manifest에 정의합니다.</p>

<p>그러면, 사용자가 앱을 설치 할 때 아래 사진과 같은 화면이 나타나, 앱이 요구하는 권한을 확인하고 승인 하도록 합니다.</p>

<p>좋은 앱을 개발하고자 한다면, 가능한 최소의 권한을 요구하도록 앱을 개발하도록 해 보세요. 여러분이 작성한 코드가 권한을 필요로 할 때, 권한을 요구하지 않고 다른 방법으로 할 수는 없는지 생각 해 보시기 바랍니다.
<img src="/blogimgs/google_play_app_permission_dialog.png" /><br /></p>

<p>AndroidManifest.xml 이 Manifest 파일 입니다. 여기에 인터넷 권한을 정의 해 봅시다. 아래와 같이 정의 하면 됩니다.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;manifest</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">package=</span><span class="s">"com.youngbin.androidstudy"</span> <span class="nt">&gt;</span>
    
    <span class="c">&lt;!-- 인터넷 Permission 정의 --&gt;</span>
    <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.INTERNET"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;application</span>
        <span class="na">android:allowBackup=</span><span class="s">"true"</span>
        <span class="na">android:icon=</span><span class="s">"@drawable/ic_launcher"</span>
        <span class="err">...</span></code></pre></figure>

<h2 id="id--">도시 ID 매개변수로 받기</h2>
<p>이제 JSON 파싱을 해서, 데이터를 화면에 표시 할 건대. 그 전에, 나중에 사용자가 따로 도시 ID 를 설정 할 수 있도록 코드를 작성하기 위해.
약간의 수정을 해서, 아까 작성한 AsyncTask 를 상속하는 클래스인 myAsyncTask 가 도시 ID 를 매개 변수로 받도록 수정 해 봅시다.
URL 은 나중에 다른 부분도 사용자가 설정 할 수 있도록 코드를 작성하기 위해, <a href="http://developer.android.com/reference/android/net/Uri.Builder.html">UriBuilder</a> 를 이용해 작성해 봅시다.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">WeatherFragment</span> <span class="kd">extends</span> <span class="n">Fragment</span> <span class="o">{</span>


    <span class="kd">public</span> <span class="n">WeatherFragment</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">View</span> <span class="n">onCreateView</span><span class="o">(</span><span class="n">LayoutInflater</span> <span class="n">inflater</span><span class="o">,</span> <span class="n">ViewGroup</span> <span class="n">container</span><span class="o">,</span>
                             <span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">View</span> <span class="n">rootView</span> <span class="o">=</span> <span class="n">inflater</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">fragment_main</span><span class="o">,</span> <span class="n">container</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="o">...</span>
        <span class="n">mat</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="s">"1838716"</span><span class="o">);</span> <span class="c1">//myAsyncTask 실행하기</span>
        <span class="k">return</span> <span class="n">rootView</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">protected</span> <span class="kd">class</span> <span class="nc">myAsyncTask</span> <span class="kd">extends</span> <span class="n">AsyncTask</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Void</span><span class="o">,</span> <span class="n">Void</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="n">Void</span> <span class="n">doInBackground</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">params</span><span class="o">)</span> <span class="o">{</span>
            <span class="o">...</span>

            <span class="c1">// 날씨 데이터 URL 에 사용될 옵션</span>
            <span class="n">String</span> <span class="n">format</span> <span class="o">=</span> <span class="s">"json"</span><span class="o">;</span>
            <span class="n">String</span> <span class="n">units</span> <span class="o">=</span> <span class="s">"metric"</span><span class="o">;</span>
            <span class="kt">int</span> <span class="n">numDays</span> <span class="o">=</span> <span class="mi">7</span><span class="o">;</span>
            <span class="k">try</span><span class="o">{</span>
                <span class="c1">//새 URL 객체</span>
                <span class="c1">//UriBuilder 를 이용해 URL 만들기</span>
                <span class="kd">final</span> <span class="n">String</span> <span class="n">FORECAST_BASE_URL</span> <span class="o">=</span>
                        <span class="s">"http://api.openweathermap.org/data/2.5/forecast/daily?"</span><span class="o">;</span>
                <span class="kd">final</span> <span class="n">String</span> <span class="n">QUERY_PARAM</span> <span class="o">=</span> <span class="s">"q"</span><span class="o">;</span>
                <span class="kd">final</span> <span class="n">String</span> <span class="n">FORMAT_PARAM</span> <span class="o">=</span> <span class="s">"mode"</span><span class="o">;</span>
                <span class="kd">final</span> <span class="n">String</span> <span class="n">UNITS_PARAM</span> <span class="o">=</span> <span class="s">"units"</span><span class="o">;</span>
                <span class="kd">final</span> <span class="n">String</span> <span class="n">DAYS_PARAM</span> <span class="o">=</span> <span class="s">"cnt"</span><span class="o">;</span>

                <span class="n">Uri</span> <span class="n">builtUri</span> <span class="o">=</span> <span class="n">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">FORECAST_BASE_URL</span><span class="o">).</span><span class="na">buildUpon</span><span class="o">()</span>
                        <span class="o">.</span><span class="na">appendQueryParameter</span><span class="o">(</span><span class="n">QUERY_PARAM</span><span class="o">,</span> <span class="n">params</span><span class="o">[</span><span class="mi">0</span><span class="o">])</span>
                        <span class="o">.</span><span class="na">appendQueryParameter</span><span class="o">(</span><span class="n">FORMAT_PARAM</span><span class="o">,</span> <span class="n">format</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">appendQueryParameter</span><span class="o">(</span><span class="n">UNITS_PARAM</span><span class="o">,</span> <span class="n">units</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">appendQueryParameter</span><span class="o">(</span><span class="n">DAYS_PARAM</span><span class="o">,</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">numDays</span><span class="o">))</span>
                        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
                
                <span class="n">URL</span> <span class="n">url</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="n">builtUri</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
               <span class="o">...</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">MalformedURLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">){</span>
                <span class="n">forecastJsonStr</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span><span class="k">finally</span><span class="o">{</span>
              <span class="o">...</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
<span class="o">}</span>
   <span class="o">...</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">onOptionsItemSelected</span><span class="o">(</span><span class="n">MenuItem</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">...</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">action_refresh</span><span class="o">)</span> <span class="o">{</span> <span class="c1">//id값이 action_refresh 이면.</span>
            <span class="c1">// 네트워크 작업 실행</span>
            <span class="n">myAsyncTask</span> <span class="n">mat</span> <span class="o">=</span> <span class="k">new</span> <span class="n">myAsyncTask</span><span class="o">();</span> <span class="c1">//myAsyncTask 객체 생성</span>
            <span class="n">mat</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="s">"1838716"</span><span class="o">);</span> <span class="c1">//myAsyncTask 실행하기</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">onOptionsItemSelected</span><span class="o">(</span><span class="n">item</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h2 id="json-parsing">JSON Parsing</h2>
<p>이제, 우리가 작성한 코드로 읽어들인 JSON 코드를 분석해서 필요한 데이터만 뽑아 화면에 표시해 봅시다.
우선, 우리가 읽어들인 데이터가 어떻게 생겼나 볼까요?
<img src="/blogimgs/json_not_formatted.png" /><br />
이 상태에서는 읽기가 좀 어렵군요. Json Formatter 를 이용해 읽기 쉽도록 해 봅시다.
<a href="http://jsonformatter.curiousconcept.com/">여기</a>를 클릭해서 Json Formatter 웹 사이트를 열고, 
입력칸에 JSON 데이터를 넣은 다음. Process 를 누르면 아래 사진과 같이 나옵니다.
<img src="/blogimgs/json_formatted.png" /><br />
<img src="/blogimgs/json_formatted_fullscreen.png" /><br />
이제 좀 읽이 편하군요. 한번 우리가 원하는 데이터를 찾아 봅시다.</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
   </span><span class="nt">"cod"</span><span class="p">:</span><span class="s2">"200"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"message"</span><span class="p">:</span><span class="mf">0.5484</span><span class="p">,</span><span class="w">
   </span><span class="nt">"city"</span><span class="p">:{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="mi">1838716</span><span class="p">,</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="s2">"Bucheon"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"coord"</span><span class="p">:{</span><span class="w">
         </span><span class="nt">"lon"</span><span class="p">:</span><span class="mf">126.783058</span><span class="p">,</span><span class="w">
         </span><span class="nt">"lat"</span><span class="p">:</span><span class="mf">37.49889</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"country"</span><span class="p">:</span><span class="s2">"KR"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"population"</span><span class="p">:</span><span class="mi">850731</span><span class="w">
   </span><span class="p">},</span><span class="w">
   </span><span class="nt">"cnt"</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span><span class="w">
   </span><span class="nt">"list"</span><span class="p">:[</span><span class="w">
      </span><span class="p">{</span><span class="w">
         </span><span class="nt">"dt"</span><span class="p">:</span><span class="mi">1420167600</span><span class="p">,</span><span class="w">
         </span><span class="nt">"temp"</span><span class="p">:{</span><span class="w">
            </span><span class="nt">"day"</span><span class="p">:</span><span class="mf">-2.75</span><span class="p">,</span><span class="w">
            </span><span class="nt">"min"</span><span class="p">:</span><span class="mf">-12.96</span><span class="p">,</span><span class="w">
            </span><span class="nt">"max"</span><span class="p">:</span><span class="mf">-1.33</span><span class="p">,</span><span class="w">
            </span><span class="nt">"night"</span><span class="p">:</span><span class="mf">-12.96</span><span class="p">,</span><span class="w">
            </span><span class="nt">"eve"</span><span class="p">:</span><span class="mf">-4.91</span><span class="p">,</span><span class="w">
            </span><span class="nt">"morn"</span><span class="p">:</span><span class="mf">-2.75</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nt">"pressure"</span><span class="p">:</span><span class="mf">1025.71</span><span class="p">,</span><span class="w">
         </span><span class="nt">"humidity"</span><span class="p">:</span><span class="mi">66</span><span class="p">,</span><span class="w">
         </span><span class="nt">"weather"</span><span class="p">:[</span><span class="w">
            </span><span class="p">{</span><span class="w">
               </span><span class="nt">"id"</span><span class="p">:</span><span class="mi">600</span><span class="p">,</span><span class="w">
               </span><span class="nt">"main"</span><span class="p">:</span><span class="s2">"Snow"</span><span class="p">,</span><span class="w">
               </span><span class="nt">"description"</span><span class="p">:</span><span class="s2">"light snow"</span><span class="p">,</span><span class="w">
               </span><span class="nt">"icon"</span><span class="p">:</span><span class="s2">"13d"</span><span class="w">
            </span><span class="p">}</span><span class="w">
         </span><span class="p">],</span><span class="w">
         </span><span class="nt">"speed"</span><span class="p">:</span><span class="mf">2.97</span><span class="p">,</span><span class="w">
         </span><span class="nt">"deg"</span><span class="p">:</span><span class="mi">321</span><span class="p">,</span><span class="w">
         </span><span class="nt">"clouds"</span><span class="p">:</span><span class="mi">64</span><span class="p">,</span><span class="w">
         </span><span class="nt">"snow"</span><span class="p">:</span><span class="mf">0.13</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
         </span><span class="nt">"dt"</span><span class="p">:</span><span class="mi">1420254000</span><span class="p">,</span><span class="w">
         </span><span class="nt">"temp"</span><span class="p">:{</span><span class="w">
            </span><span class="nt">"day"</span><span class="p">:</span><span class="mf">-2.05</span><span class="p">,</span><span class="w">
            </span><span class="nt">"min"</span><span class="p">:</span><span class="mf">-16.49</span><span class="p">,</span><span class="w">
            </span><span class="nt">"max"</span><span class="p">:</span><span class="mf">0.28</span><span class="p">,</span><span class="w">
            </span><span class="nt">"night"</span><span class="p">:</span><span class="mf">-6.6</span><span class="p">,</span><span class="w">
            </span><span class="nt">"eve"</span><span class="p">:</span><span class="mf">-3.53</span><span class="p">,</span><span class="w">
            </span><span class="nt">"morn"</span><span class="p">:</span><span class="mf">-16.49</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nt">"pressure"</span><span class="p">:</span><span class="mf">1025.72</span><span class="p">,</span><span class="w">
         </span><span class="nt">"humidity"</span><span class="p">:</span><span class="mi">67</span><span class="p">,</span><span class="w">
         </span><span class="nt">"weather"</span><span class="p">:[</span><span class="w">
            </span><span class="p">{</span><span class="w">
               </span><span class="nt">"id"</span><span class="p">:</span><span class="mi">802</span><span class="p">,</span><span class="w">
               </span><span class="nt">"main"</span><span class="p">:</span><span class="s2">"Clouds"</span><span class="p">,</span><span class="w">
               </span><span class="nt">"description"</span><span class="p">:</span><span class="s2">"scattered clouds"</span><span class="p">,</span><span class="w">
               </span><span class="nt">"icon"</span><span class="p">:</span><span class="s2">"03d"</span><span class="w">
            </span><span class="p">}</span><span class="w">
         </span><span class="p">],</span><span class="w">
         </span><span class="nt">"speed"</span><span class="p">:</span><span class="mf">1.96</span><span class="p">,</span><span class="w">
         </span><span class="nt">"deg"</span><span class="p">:</span><span class="mi">128</span><span class="p">,</span><span class="w">
         </span><span class="nt">"clouds"</span><span class="p">:</span><span class="mi">32</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
         </span><span class="nt">"dt"</span><span class="p">:</span><span class="mi">1420340400</span><span class="p">,</span><span class="w">
         </span><span class="nt">"temp"</span><span class="p">:{</span><span class="w">
            </span><span class="nt">"day"</span><span class="p">:</span><span class="mf">8.94</span><span class="p">,</span><span class="w">
            </span><span class="nt">"min"</span><span class="p">:</span><span class="mf">-8.03</span><span class="p">,</span><span class="w">
            </span><span class="nt">"max"</span><span class="p">:</span><span class="mf">8.94</span><span class="p">,</span><span class="w">
            </span><span class="nt">"night"</span><span class="p">:</span><span class="mf">-8.03</span><span class="p">,</span><span class="w">
            </span><span class="nt">"eve"</span><span class="p">:</span><span class="mf">2.42</span><span class="p">,</span><span class="w">
            </span><span class="nt">"morn"</span><span class="p">:</span><span class="mf">-2.2</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nt">"pressure"</span><span class="p">:</span><span class="mf">1017.87</span><span class="p">,</span><span class="w">
         </span><span class="nt">"humidity"</span><span class="p">:</span><span class="mi">71</span><span class="p">,</span><span class="w">
         </span><span class="nt">"weather"</span><span class="p">:[</span><span class="w">
            </span><span class="p">{</span><span class="w">
               </span><span class="nt">"id"</span><span class="p">:</span><span class="mi">802</span><span class="p">,</span><span class="w">
               </span><span class="nt">"main"</span><span class="p">:</span><span class="s2">"Clouds"</span><span class="p">,</span><span class="w">
               </span><span class="nt">"description"</span><span class="p">:</span><span class="s2">"scattered clouds"</span><span class="p">,</span><span class="w">
               </span><span class="nt">"icon"</span><span class="p">:</span><span class="s2">"03d"</span><span class="w">
            </span><span class="p">}</span><span class="w">
         </span><span class="p">],</span><span class="w">
         </span><span class="nt">"speed"</span><span class="p">:</span><span class="mf">4.61</span><span class="p">,</span><span class="w">
         </span><span class="nt">"deg"</span><span class="p">:</span><span class="mi">256</span><span class="p">,</span><span class="w">
         </span><span class="nt">"clouds"</span><span class="p">:</span><span class="mi">44</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
         </span><span class="nt">"dt"</span><span class="p">:</span><span class="mi">1420426800</span><span class="p">,</span><span class="w">
         </span><span class="nt">"temp"</span><span class="p">:{</span><span class="w">
            </span><span class="nt">"day"</span><span class="p">:</span><span class="mf">6.69</span><span class="p">,</span><span class="w">
            </span><span class="nt">"min"</span><span class="p">:</span><span class="mf">-3.56</span><span class="p">,</span><span class="w">
            </span><span class="nt">"max"</span><span class="p">:</span><span class="mf">6.69</span><span class="p">,</span><span class="w">
            </span><span class="nt">"night"</span><span class="p">:</span><span class="mf">1.61</span><span class="p">,</span><span class="w">
            </span><span class="nt">"eve"</span><span class="p">:</span><span class="mf">0.58</span><span class="p">,</span><span class="w">
            </span><span class="nt">"morn"</span><span class="p">:</span><span class="mf">-3.56</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nt">"pressure"</span><span class="p">:</span><span class="mf">1022.54</span><span class="p">,</span><span class="w">
         </span><span class="nt">"humidity"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
         </span><span class="nt">"weather"</span><span class="p">:[</span><span class="w">
            </span><span class="p">{</span><span class="w">
               </span><span class="nt">"id"</span><span class="p">:</span><span class="mi">500</span><span class="p">,</span><span class="w">
               </span><span class="nt">"main"</span><span class="p">:</span><span class="s2">"Rain"</span><span class="p">,</span><span class="w">
               </span><span class="nt">"description"</span><span class="p">:</span><span class="s2">"light rain"</span><span class="p">,</span><span class="w">
               </span><span class="nt">"icon"</span><span class="p">:</span><span class="s2">"10d"</span><span class="w">
            </span><span class="p">}</span><span class="w">
         </span><span class="p">],</span><span class="w">
         </span><span class="nt">"speed"</span><span class="p">:</span><span class="mf">1.67</span><span class="p">,</span><span class="w">
         </span><span class="nt">"deg"</span><span class="p">:</span><span class="mi">174</span><span class="p">,</span><span class="w">
         </span><span class="nt">"clouds"</span><span class="p">:</span><span class="mi">86</span><span class="p">,</span><span class="w">
         </span><span class="nt">"rain"</span><span class="p">:</span><span class="mf">1.94</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
         </span><span class="nt">"dt"</span><span class="p">:</span><span class="mi">1420513200</span><span class="p">,</span><span class="w">
         </span><span class="nt">"temp"</span><span class="p">:{</span><span class="w">
            </span><span class="nt">"day"</span><span class="p">:</span><span class="mf">-2.1</span><span class="p">,</span><span class="w">
            </span><span class="nt">"min"</span><span class="p">:</span><span class="mf">-7.67</span><span class="p">,</span><span class="w">
            </span><span class="nt">"max"</span><span class="p">:</span><span class="mf">1.85</span><span class="p">,</span><span class="w">
            </span><span class="nt">"night"</span><span class="p">:</span><span class="mf">-7.67</span><span class="p">,</span><span class="w">
            </span><span class="nt">"eve"</span><span class="p">:</span><span class="mf">-5.76</span><span class="p">,</span><span class="w">
            </span><span class="nt">"morn"</span><span class="p">:</span><span class="mf">1.85</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nt">"pressure"</span><span class="p">:</span><span class="mf">1018.91</span><span class="p">,</span><span class="w">
         </span><span class="nt">"humidity"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
         </span><span class="nt">"weather"</span><span class="p">:[</span><span class="w">
            </span><span class="p">{</span><span class="w">
               </span><span class="nt">"id"</span><span class="p">:</span><span class="mi">500</span><span class="p">,</span><span class="w">
               </span><span class="nt">"main"</span><span class="p">:</span><span class="s2">"Rain"</span><span class="p">,</span><span class="w">
               </span><span class="nt">"description"</span><span class="p">:</span><span class="s2">"light rain"</span><span class="p">,</span><span class="w">
               </span><span class="nt">"icon"</span><span class="p">:</span><span class="s2">"10d"</span><span class="w">
            </span><span class="p">}</span><span class="w">
         </span><span class="p">],</span><span class="w">
         </span><span class="nt">"speed"</span><span class="p">:</span><span class="mf">9.3</span><span class="p">,</span><span class="w">
         </span><span class="nt">"deg"</span><span class="p">:</span><span class="mi">317</span><span class="p">,</span><span class="w">
         </span><span class="nt">"clouds"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
         </span><span class="nt">"rain"</span><span class="p">:</span><span class="mf">0.53</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
         </span><span class="nt">"dt"</span><span class="p">:</span><span class="mi">1420599600</span><span class="p">,</span><span class="w">
         </span><span class="nt">"temp"</span><span class="p">:{</span><span class="w">
            </span><span class="nt">"day"</span><span class="p">:</span><span class="mf">-3.9</span><span class="p">,</span><span class="w">
            </span><span class="nt">"min"</span><span class="p">:</span><span class="mf">-7.56</span><span class="p">,</span><span class="w">
            </span><span class="nt">"max"</span><span class="p">:</span><span class="mf">-3.9</span><span class="p">,</span><span class="w">
            </span><span class="nt">"night"</span><span class="p">:</span><span class="mf">-6.9</span><span class="p">,</span><span class="w">
            </span><span class="nt">"eve"</span><span class="p">:</span><span class="mf">-5.98</span><span class="p">,</span><span class="w">
            </span><span class="nt">"morn"</span><span class="p">:</span><span class="mf">-7.56</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nt">"pressure"</span><span class="p">:</span><span class="mf">1026.48</span><span class="p">,</span><span class="w">
         </span><span class="nt">"humidity"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
         </span><span class="nt">"weather"</span><span class="p">:[</span><span class="w">
            </span><span class="p">{</span><span class="w">
               </span><span class="nt">"id"</span><span class="p">:</span><span class="mi">800</span><span class="p">,</span><span class="w">
               </span><span class="nt">"main"</span><span class="p">:</span><span class="s2">"Clear"</span><span class="p">,</span><span class="w">
               </span><span class="nt">"description"</span><span class="p">:</span><span class="s2">"sky is clear"</span><span class="p">,</span><span class="w">
               </span><span class="nt">"icon"</span><span class="p">:</span><span class="s2">"01d"</span><span class="w">
            </span><span class="p">}</span><span class="w">
         </span><span class="p">],</span><span class="w">
         </span><span class="nt">"speed"</span><span class="p">:</span><span class="mf">6.29</span><span class="p">,</span><span class="w">
         </span><span class="nt">"deg"</span><span class="p">:</span><span class="mi">317</span><span class="p">,</span><span class="w">
         </span><span class="nt">"clouds"</span><span class="p">:</span><span class="mi">0</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
         </span><span class="nt">"dt"</span><span class="p">:</span><span class="mi">1420686000</span><span class="p">,</span><span class="w">
         </span><span class="nt">"temp"</span><span class="p">:{</span><span class="w">
            </span><span class="nt">"day"</span><span class="p">:</span><span class="mi">-1</span><span class="p">,</span><span class="w">
            </span><span class="nt">"min"</span><span class="p">:</span><span class="mf">-5.52</span><span class="p">,</span><span class="w">
            </span><span class="nt">"max"</span><span class="p">:</span><span class="mi">-1</span><span class="p">,</span><span class="w">
            </span><span class="nt">"night"</span><span class="p">:</span><span class="mf">-4.93</span><span class="p">,</span><span class="w">
            </span><span class="nt">"eve"</span><span class="p">:</span><span class="mf">-4.1</span><span class="p">,</span><span class="w">
            </span><span class="nt">"morn"</span><span class="p">:</span><span class="mf">-5.52</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nt">"pressure"</span><span class="p">:</span><span class="mf">1028.05</span><span class="p">,</span><span class="w">
         </span><span class="nt">"humidity"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
         </span><span class="nt">"weather"</span><span class="p">:[</span><span class="w">
            </span><span class="p">{</span><span class="w">
               </span><span class="nt">"id"</span><span class="p">:</span><span class="mi">800</span><span class="p">,</span><span class="w">
               </span><span class="nt">"main"</span><span class="p">:</span><span class="s2">"Clear"</span><span class="p">,</span><span class="w">
               </span><span class="nt">"description"</span><span class="p">:</span><span class="s2">"sky is clear"</span><span class="p">,</span><span class="w">
               </span><span class="nt">"icon"</span><span class="p">:</span><span class="s2">"01d"</span><span class="w">
            </span><span class="p">}</span><span class="w">
         </span><span class="p">],</span><span class="w">
         </span><span class="nt">"speed"</span><span class="p">:</span><span class="mf">6.51</span><span class="p">,</span><span class="w">
         </span><span class="nt">"deg"</span><span class="p">:</span><span class="mi">315</span><span class="p">,</span><span class="w">
         </span><span class="nt">"clouds"</span><span class="p">:</span><span class="mi">0</span><span class="w">
      </span><span class="p">}</span><span class="w">
   </span><span class="p">]</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>각 요일별 날씨 상태(예를들면 맑은, 눈이 옴, 비가 옴, 흐림 등)와 최대기온, 최저기온을 얻어 봅시다.
각 요일별 날씨는 “list” 라는 Json Array 안에 있고. 그 안에 있는 각 객체 안에 날씨 데이터가 있습니다.
최대기온과 최저기온에 해당되는 “max” 와 “min” 은 “temp” 라는 객체 내부에 있고.
날씨 상태에 해당되는 “main” 은 “weather” 라는 Json Array 의 0번째 객체 안에 있습니다.</p>

<p>먼저, 7일치 날씨정보를 저장할 String[]을 하나 만들고, 반복문을 작성해서 각 요일별 날씨 객체를 얻어냅시다.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java">    <span class="kd">protected</span> <span class="kd">class</span> <span class="nc">myAsyncTask</span> <span class="kd">extends</span> <span class="n">AsyncTask</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Void</span><span class="o">,</span> <span class="n">String</span><span class="o">[]&gt;</span> <span class="o">{</span> <span class="c1">// 네트워크 작업 후 String[]을 반환 하도록 수정</span>
        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="n">String</span><span class="o">[]</span> <span class="n">doInBackground</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">params</span><span class="o">)</span> <span class="o">{</span>
            <span class="o">...</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">JSONObject</span> <span class="n">JsonObj</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="n">forecastJsonStr</span><span class="o">);</span> <span class="c1">//읽어들인 String 을 JSONObject로 변환</span>
                <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"JSON"</span><span class="o">,</span> <span class="n">forecastJsonStr</span><span class="o">);</span>
                <span class="n">JSONArray</span> <span class="n">JsonArray</span> <span class="o">=</span> <span class="n">JsonObj</span><span class="o">.</span><span class="na">getJSONArray</span><span class="o">(</span><span class="s">"list"</span><span class="o">);</span> <span class="c1">//"list" Json Array 얻기</span>
                <span class="c1">//데이터를 저장한 String[] 생성. JsonArray 의 항목 수 만큼 데이터를 넣을 수 있도록 생성</span>
                <span class="n">String</span><span class="o">[]</span> <span class="n">WeatherDataArray</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="n">JsonArray</span><span class="o">.</span><span class="na">length</span><span class="o">()];</span> 
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">JsonArray</span><span class="o">.</span><span class="na">length</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span> <span class="c1">//반복문</span>
                    <span class="n">String</span> <span class="n">MaxTemp</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// 최대기온 저장할 변수</span>
                    <span class="n">String</span> <span class="n">MinTemp</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// 최저기온 저장할 변수</span>
                    <span class="n">String</span> <span class="n">WeatherMain</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// 날씨상태 저장할 변수</span>
                    <span class="n">String</span> <span class="n">Item</span><span class="o">;</span> <span class="c1">// 1일 날씨정보 저장할 변수</span>
                    <span class="n">JSONObject</span> <span class="n">EachObj</span> <span class="o">=</span> <span class="n">JsonArray</span><span class="o">.</span><span class="na">getJSONObject</span><span class="o">(</span><span class="n">i</span><span class="o">);</span> <span class="c1">// i 번째 객체 얻기</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">WeatherDataArray</span><span class="o">;</span> <span class="c1">// 데이터 반환</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">JSONException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
         <span class="o">...</span>
         <span class="o">}</span>
        <span class="o">}</span>
         </code></pre></figure>

<p>먼저 최대 기온과 최저 기온을 얻어내 봅시다.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java">    <span class="kd">protected</span> <span class="kd">class</span> <span class="nc">myAsyncTask</span> <span class="kd">extends</span> <span class="n">AsyncTask</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Void</span><span class="o">,</span> <span class="n">String</span><span class="o">[]&gt;</span> <span class="o">{</span> <span class="c1">// 네트워크 작업 후 String[]을 반환 하도록 수정</span>
        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="n">String</span><span class="o">[]</span> <span class="n">doInBackground</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">params</span><span class="o">)</span> <span class="o">{</span>
            <span class="o">...</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">JSONObject</span> <span class="n">JsonObj</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="n">forecastJsonStr</span><span class="o">);</span> <span class="c1">//읽어들인 String 을 JSONObject로 변환</span>
                <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"JSON"</span><span class="o">,</span> <span class="n">forecastJsonStr</span><span class="o">);</span>
                <span class="n">JSONArray</span> <span class="n">JsonArray</span> <span class="o">=</span> <span class="n">JsonObj</span><span class="o">.</span><span class="na">getJSONArray</span><span class="o">(</span><span class="s">"list"</span><span class="o">);</span> <span class="c1">//"list" Json Array 얻기</span>
                <span class="c1">//데이터를 저장한 String[] 생성. JsonArray 의 항목 수 만큼 데이터를 넣을 수 있도록 생성</span>
                <span class="n">String</span><span class="o">[]</span> <span class="n">WeatherDataArray</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="n">JsonArray</span><span class="o">.</span><span class="na">length</span><span class="o">()];</span> 
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">JsonArray</span><span class="o">.</span><span class="na">length</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span> <span class="c1">//반복문</span>
                    <span class="n">String</span> <span class="n">MaxTemp</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// 최대기온 저장할 변수</span>
                    <span class="n">String</span> <span class="n">MinTemp</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// 최저기온 저장할 변수</span>
                    <span class="n">String</span> <span class="n">WeatherMain</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// 날씨상태 저장할 변수</span>
                    <span class="n">String</span> <span class="n">Item</span><span class="o">;</span> <span class="c1">// 1일 날씨정보 저장할 변수</span>
                    <span class="n">JSONObject</span> <span class="n">EachObj</span> <span class="o">=</span> <span class="n">JsonArray</span><span class="o">.</span><span class="na">getJSONObject</span><span class="o">(</span><span class="n">i</span><span class="o">);</span> <span class="c1">// i 번째 객체 얻기</span>
                    <span class="n">JSONObject</span> <span class="n">Temp</span> <span class="o">=</span> <span class="n">EachObj</span><span class="o">.</span><span class="na">getJSONObject</span><span class="o">(</span><span class="s">"temp"</span><span class="o">);</span> <span class="c1">// i 번쨰 객체에서 "temp" 객체 얻기</span>
                    <span class="n">MaxTemp</span> <span class="o">=</span> <span class="n">Temp</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"max"</span><span class="o">);</span> <span class="c1">// "temp" 객체에서 최대기온인 "max" 얻기</span>
                    <span class="n">MinTemp</span> <span class="o">=</span> <span class="n">Temp</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"min"</span><span class="o">);</span> <span class="c1">// "temp" 객체에서 최저기온인 "min" 얻기</span>

                <span class="o">}</span>
                <span class="k">return</span> <span class="n">WeatherDataArray</span><span class="o">;</span> <span class="c1">// 데이터 반환</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">JSONException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
         <span class="o">...</span>
         <span class="o">}</span>
        <span class="o">}</span>
         </code></pre></figure>

<p>그리고 이어서 날씨 상태를 얻어내 봅시다.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java">    <span class="o">...</span>
    <span class="kd">protected</span> <span class="kd">class</span> <span class="nc">myAsyncTask</span> <span class="kd">extends</span> <span class="n">AsyncTask</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Void</span><span class="o">,</span> <span class="n">String</span><span class="o">[]&gt;</span> <span class="o">{</span> <span class="c1">// 네트워크 작업 후 String[]을 반환 하도록 수정</span>
        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="n">String</span><span class="o">[]</span> <span class="n">doInBackground</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">params</span><span class="o">)</span> <span class="o">{</span>
            <span class="o">...</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">JSONObject</span> <span class="n">JsonObj</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="n">forecastJsonStr</span><span class="o">);</span> <span class="c1">//읽어들인 String 을 JSONObject로 변환</span>
                <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"JSON"</span><span class="o">,</span> <span class="n">forecastJsonStr</span><span class="o">);</span>
                <span class="n">JSONArray</span> <span class="n">JsonArray</span> <span class="o">=</span> <span class="n">JsonObj</span><span class="o">.</span><span class="na">getJSONArray</span><span class="o">(</span><span class="s">"list"</span><span class="o">);</span> <span class="c1">//"list" Json Array 얻기</span>
                <span class="c1">//데이터를 저장한 String[] 생성. JsonArray 의 항목 수 만큼 데이터를 넣을 수 있도록 생성</span>
                <span class="n">String</span><span class="o">[]</span> <span class="n">WeatherDataArray</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="n">JsonArray</span><span class="o">.</span><span class="na">length</span><span class="o">()];</span> 
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">JsonArray</span><span class="o">.</span><span class="na">length</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span> <span class="c1">//반복문</span>
                    <span class="n">String</span> <span class="n">MaxTemp</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// 최대기온 저장할 변수</span>
                    <span class="n">String</span> <span class="n">MinTemp</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// 최저기온 저장할 변수</span>
                    <span class="n">String</span> <span class="n">WeatherMain</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// 날씨상태 저장할 변수</span>
                    <span class="n">String</span> <span class="n">Item</span><span class="o">;</span> <span class="c1">// 1일 날씨정보 저장할 변수</span>
                    <span class="n">JSONObject</span> <span class="n">EachObj</span> <span class="o">=</span> <span class="n">JsonArray</span><span class="o">.</span><span class="na">getJSONObject</span><span class="o">(</span><span class="n">i</span><span class="o">);</span> <span class="c1">// i 번째 객체 얻기</span>
                    <span class="n">JSONObject</span> <span class="n">Temp</span> <span class="o">=</span> <span class="n">EachObj</span><span class="o">.</span><span class="na">getJSONObject</span><span class="o">(</span><span class="s">"temp"</span><span class="o">);</span> <span class="c1">// i 번쨰 객체에서 "temp" 객체 얻기</span>
                    <span class="n">MaxTemp</span> <span class="o">=</span> <span class="n">Temp</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"max"</span><span class="o">);</span> <span class="c1">// "temp" 객체에서 최대기온인 "max" 얻기</span>
                    <span class="n">MinTemp</span> <span class="o">=</span> <span class="n">Temp</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"min"</span><span class="o">);</span> <span class="c1">// "temp" 객체에서 최저기온인 "min" 얻기</span>

                    <span class="c1">// i 번째 객체에서 "weather" Json Array 얻기</span>
                    <span class="n">JSONArray</span> <span class="n">WeatherArray</span> <span class="o">=</span> <span class="n">EachObj</span><span class="o">.</span><span class="na">getJSONArray</span><span class="o">(</span><span class="s">"weather"</span><span class="o">);</span>
                    <span class="c1">// "weather" Json Array 의 0번째 객체 얻기</span>
                    <span class="n">JSONObject</span> <span class="n">WeatherObj</span> <span class="o">=</span> <span class="n">WeatherArray</span><span class="o">.</span><span class="na">getJSONObject</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
                    <span class="c1">// 0번째 객체에서 날씨 상태에 해당되는 "main" 얻기</span>
                    <span class="n">WeatherMain</span> <span class="o">=</span> <span class="n">WeatherObj</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"main"</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">WeatherDataArray</span><span class="o">;</span> <span class="c1">// 데이터 반환</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">JSONException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
         <span class="o">...</span>
         <span class="o">}</span>
        <span class="o">}</span>
        <span class="o">...</span></code></pre></figure>

<p>그리고, 하나의 문자열로 묶어서 배열에 넣어 봅시다.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java">    <span class="kd">protected</span> <span class="kd">class</span> <span class="nc">myAsyncTask</span> <span class="kd">extends</span> <span class="n">AsyncTask</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Void</span><span class="o">,</span> <span class="n">String</span><span class="o">[]&gt;</span> <span class="o">{</span> <span class="c1">// 네트워크 작업 후 String[]을 반환 하도록 수정</span>
        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="n">String</span><span class="o">[]</span> <span class="n">doInBackground</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">params</span><span class="o">)</span> <span class="o">{</span>
            <span class="o">...</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">JSONObject</span> <span class="n">JsonObj</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="n">forecastJsonStr</span><span class="o">);</span> <span class="c1">//읽어들인 String 을 JSONObject로 변환</span>
                <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"JSON"</span><span class="o">,</span> <span class="n">forecastJsonStr</span><span class="o">);</span>
                <span class="n">JSONArray</span> <span class="n">JsonArray</span> <span class="o">=</span> <span class="n">JsonObj</span><span class="o">.</span><span class="na">getJSONArray</span><span class="o">(</span><span class="s">"list"</span><span class="o">);</span> <span class="c1">//"list" Json Array 얻기</span>
                <span class="c1">//데이터를 저장한 String[] 생성. JsonArray 의 항목 수 만큼 데이터를 넣을 수 있도록 생성</span>
                <span class="n">String</span><span class="o">[]</span> <span class="n">WeatherDataArray</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="n">JsonArray</span><span class="o">.</span><span class="na">length</span><span class="o">()];</span> 
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">JsonArray</span><span class="o">.</span><span class="na">length</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span> <span class="c1">//반복문</span>
                    <span class="n">String</span> <span class="n">MaxTemp</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// 최대기온 저장할 변수</span>
                    <span class="n">String</span> <span class="n">MinTemp</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// 최저기온 저장할 변수</span>
                    <span class="n">String</span> <span class="n">WeatherMain</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// 날씨상태 저장할 변수</span>
                    <span class="n">String</span> <span class="n">Item</span><span class="o">;</span> <span class="c1">// 1일 날씨정보 저장할 변수</span>
                    <span class="n">JSONObject</span> <span class="n">EachObj</span> <span class="o">=</span> <span class="n">JsonArray</span><span class="o">.</span><span class="na">getJSONObject</span><span class="o">(</span><span class="n">i</span><span class="o">);</span> <span class="c1">// i 번째 객체 얻기</span>
                    <span class="n">JSONObject</span> <span class="n">Temp</span> <span class="o">=</span> <span class="n">EachObj</span><span class="o">.</span><span class="na">getJSONObject</span><span class="o">(</span><span class="s">"temp"</span><span class="o">);</span> <span class="c1">// i 번쨰 객체에서 "temp" 객체 얻기</span>
                    <span class="n">MaxTemp</span> <span class="o">=</span> <span class="n">Temp</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"max"</span><span class="o">);</span> <span class="c1">// "temp" 객체에서 최대기온인 "max" 얻기</span>
                    <span class="n">MinTemp</span> <span class="o">=</span> <span class="n">Temp</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"min"</span><span class="o">);</span> <span class="c1">// "temp" 객체에서 최저기온인 "min" 얻기</span>

                    <span class="c1">// i 번째 객체에서 "weather" Json Array 얻기</span>
                    <span class="n">JSONArray</span> <span class="n">WeatherArray</span> <span class="o">=</span> <span class="n">EachObj</span><span class="o">.</span><span class="na">getJSONArray</span><span class="o">(</span><span class="s">"weather"</span><span class="o">);</span>
                    <span class="c1">// "weather" Json Array 의 0번째 객체 얻기</span>
                    <span class="n">JSONObject</span> <span class="n">WeatherObj</span> <span class="o">=</span> <span class="n">WeatherArray</span><span class="o">.</span><span class="na">getJSONObject</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
                    <span class="c1">// 0번째 객체에서 날씨 상태에 해당되는 "main" 얻기</span>
                    <span class="n">WeatherMain</span> <span class="o">=</span> <span class="n">WeatherObj</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"main"</span><span class="o">);</span>
                        
                    <span class="c1">//하나의 문자열로 저장</span>
                    <span class="n">Item</span> <span class="o">=</span> <span class="n">WeatherMain</span> <span class="o">+</span> <span class="s">" : "</span> <span class="o">+</span> <span class="s">" MAX="</span> <span class="o">+</span> <span class="n">MaxTemp</span> <span class="o">+</span> <span class="s">" MIN="</span> <span class="o">+</span> <span class="n">MinTemp</span><span class="o">;</span>
                    <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"Item"</span><span class="o">,</span><span class="n">Item</span><span class="o">);</span>
                    <span class="c1">// WeatherDataArray 에 i 번째 항목으로 넣기</span>
                    <span class="n">WeatherDataArray</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">Item</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">WeatherDataArray</span><span class="o">;</span> <span class="c1">// 데이터 반환</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">JSONException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
         <span class="o">...</span>
         <span class="o">}</span>
        <span class="o">}</span>
         </code></pre></figure>

<h2 id="adapter-">Adapter 갱신하기</h2>
<p>이제 날씨 데이터를 뽑아내기 까지 했으니, Adapter 에 새 데이터를 전달해서, 우리가 뽑아낸 데이터가 ListView 에 나타나도록 해 봅시다.
Adapter 에 접근 하는것은 UI 에 접근 하는 것이기 때문에, doInBackground(Params…) 에서 처리 하면 안 되고.
onPostExecute(Result) 를 따로 구현해서 처리 해 줘야 합니다.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">protected</span> <span class="kd">class</span> <span class="nc">myAsyncTask</span> <span class="kd">extends</span> <span class="n">AsyncTask</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Void</span><span class="o">,</span> <span class="n">String</span><span class="o">[]&gt;</span> <span class="o">{</span>
<span class="o">...</span>
        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="kt">void</span> <span class="n">onPostExecute</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">Data</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// 백그라운드 작업 후, UI Thread 에서 실행 됩니다.</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">Data</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">myAdapter</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span> <span class="c1">// Adapter 가 가진 데이터 모두 지우기</span>
                <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">dayForecastStr</span> <span class="o">:</span> <span class="n">Data</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">myAdapter</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">dayForecastStr</span><span class="o">);</span> <span class="c1">// 반복문 이용해 데이터 새로 넣기</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>Adapter 가 가진 데이터가 변경되면. Adapter.notifyDataSetChanged(); 를 호출해서 데이터가 변경 되었음을 알려야 합니다. 그러나 우리는 굳이 따로 호출 해 줄 필요가 없습니다.
우리가 호출한 Adapter.clear(); 와 Adapter.add(String); 이 호출 될 때, Adapter.notifyDataSetChanged(); 이 같이 호출 되기 때문입니다.
그걸 제가 어떻게 아냐고요? 안드로이드는 오픈소스여서 소스코드를 들여다 볼 수 있습니다. 당연히 API 들이 구현된 Framework 도 들여다 볼 수 있습니다.
한번 소스를 들여다 봅시다. 그리고 Adapter.clear(); 와 Adapter.add(String); 에서 실제로 Adapter.notifyDataSetChanged(); 이 호출 되는지 확인 해 봅시다.
<a href="https://android.googlesource.com/platform/frameworks/base/+/master/core/java/android/widget/ArrayAdapter.java">여기</a> 를 클릭해서 ArrayAdapter 클래스 소스코드를 들여다 봅시다.</p>

<p>clear 를 검색해서, 해당 메서드를 찿아보세요. 사진에서 보시다 싶이 실제로 내부에서 호출 되고 있습니다.
<img src="/blogimgs/arrayadapter_clear_method.png" /><br />
add 를 검색해서, 해당 메서드를 찿아보면, 역시 내부에서 호출 해 주고 있습니다.
<img src="/blogimgs/arrayadapter_add_method.png" /><br />
안드로이드는 오픈소스 이기 때문에, 이렇게 소스코드를 들여다 보실 수 있습니다. 
소스코드를 들여다 보시는 것은 여러분들이 안드로이드 시스템이 어떻게 동작 하는지 알아 보실 수 있으며, 이는 앱을 개발 할 때 많은 도움이 될 겁니다.</p>

<h2 id="section-3">앱 실행 결과.</h2>
<p>여기까지 Lesson 2 내용 정리 였습니다. 이제 작성한 앱을 실행 해 보세요. 아래 사진과 같이 잘 나오나요??
<img src="/blogimgs/lesson_two_result.png" /><br /></p>

<h2 id="section-4">소스코드</h2>
<p>Lesson 2 에 해당되는 소스코드 입니다.
<a href="https://github.com/sukso96100/zionhs_android_study/tree/lesson2">https://github.com/sukso96100/zionhs_android_study/tree/lesson2</a></p>

<h2 id="httpurlconnection---------">귀찮게 HttpURLConnection 쓰고 쓰레드 돌리지 않고 라이브러리 이용해서 쉽게 네트워킹 하기.</h2>
<p>귀찮게 일일이 연결 열고, InputStream 을 String 으로 변환하거나 하지 말고, 라이브러리를 이용해 편리하게 해 봅시다.
많은 개발자 분들이 안드로이드 에서 사용 가능한 다양한 라이브러리를 개발해 둬서, 라이브러리를 잘 활용해 구현하기 어려운 것도 쉽게 구현 할 수 있습니다.</p>

<p>안드로이드 네트워킹을 쉽게 할 수 있도록 해 주는 라이브러리도 아주 다양합니다. RetroFit, OkHttp, Volley, Loopj Async-HttpClient 등이 있는대.
이 포스트에서는 <a href="http://square.github.io/okhttp/">OkHttp</a> 를 한번 다뤄 보고자 합니다. 먼저 라이브러리를 추가 해 줍시다. 우리는 Android Studio 를 사용하죠? Lesson 1 에서 언급한 Gradle 이 알아서 의존성 등을 처리해 줍니다. gradle 빌드 스크립트에 한 줄만 추가하면 라이브러리 추가는 끝납니다. 앱 모듈 디렉터리에 위치한 build.gradle 을 열고, dependencies 에 한줄 추가 합니다.</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="o">...</span>
<span class="n">dependencies</span> <span class="o">{</span>
    <span class="n">compile</span> <span class="nf">fileTree</span><span class="o">(</span><span class="nl">include:</span> <span class="o">[</span><span class="s1">'*.jar'</span><span class="o">],</span> <span class="nl">dir:</span> <span class="s1">'libs'</span><span class="o">)</span>
    <span class="n">compile</span> <span class="s1">'com.android.support:appcompat-v7:21.0.3'</span>
    <span class="n">compile</span> <span class="s1">'com.squareup.okhttp:okhttp:2.2.0'</span> <span class="c1">// 이거 한줄만 추가하면 됩니다.</span>
<span class="o">}</span>
<span class="o">...</span></code></pre></figure>

<p><a href="https://github.com/square/okhttp/wiki">OkHttp 의 Wiki 문서</a>나 <a href="http://square.github.io/okhttp/javadoc/index.html">JavaDoc 문서</a>를 참고해서 코드를 작성 하시면 됩니다. 아래는 비동기 방식으로 네트워크 작업을 OkHttp 로 하는 방법의 예시 입니다.
우리가 기존에 사용하던 방법에 비하면 정말 간단하지 않나요?</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java">  <span class="kd">private</span> <span class="kd">final</span> <span class="n">OkHttpClient</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OkHttpClient</span><span class="o">();</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="n">run</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Request</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">url</span><span class="o">(</span><span class="s">"http://publicobject.com/helloworld.txt"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>

    <span class="n">client</span><span class="o">.</span><span class="na">newCall</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">enqueue</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">()</span> <span class="o">{</span>
      <span class="nd">@Override</span> <span class="kd">public</span> <span class="kt">void</span> <span class="n">onFailure</span><span class="o">(</span><span class="n">Request</span> <span class="n">request</span><span class="o">,</span> <span class="n">Throwable</span> <span class="n">throwable</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//네트워크 작업 실패한 경우 여기 있는 코드가 실행 됩니다.</span>
        <span class="n">throwable</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
      <span class="o">}</span>

      <span class="nd">@Override</span> <span class="kd">public</span> <span class="kt">void</span> <span class="n">onResponse</span><span class="o">(</span><span class="n">Response</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">response</span><span class="o">.</span><span class="na">isSuccessful</span><span class="o">())</span> <span class="k">throw</span> <span class="k">new</span> <span class="n">IOException</span><span class="o">(</span><span class="s">"Unexpected code "</span> <span class="o">+</span> <span class="n">response</span><span class="o">);</span>
            <span class="c1">//네트워크 작업을 성공적으로 마처서 응답을 받은 경우 여기 있는 코드가 실행됩니다.</span>
            <span class="c1">//reponse 가지고 작업 하시면 됩니다.</span>
        <span class="n">Headers</span> <span class="n">responseHeaders</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">headers</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">responseHeaders</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
          <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">responseHeaders</span><span class="o">.</span><span class="na">name</span><span class="o">(</span><span class="n">i</span><span class="o">)</span> <span class="o">+</span> <span class="s">": "</span> <span class="o">+</span> <span class="n">responseHeaders</span><span class="o">.</span><span class="na">value</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">body</span><span class="o">().</span><span class="na">string</span><span class="o">());</span>
      <span class="o">}</span>
    <span class="o">});</span>
  <span class="o">}</span></code></pre></figure>

<h2 id="section-5">추가 자료들…</h2>
<p>이 포스트를 보실 때 참고 하시면 좋은 자료들과 웹 사이트 입니다.</p>

<ul>
  <li><a href="http://openweathermap.org/api">OpenWeatherMap API</a></li>
  <li><a href="http://developer.android.com/reference/java/net/HttpURLConnection.html">Android Develoers - HttpURLConnection</a></li>
  <li><a href="http://developer.android.com/reference/android/util/Log.html">Android Developers - Log</a></li>
  <li><a href="http://developer.android.com/training/basics/network-ops/connecting.html">Android Developers - Connectingeeㄸ to the Network</a></li>
  <li><a href="http://developer.android.com/guide/topics/security/permissions.html">Android Developers - System Permissions</a></li>
  <li><a href="http://developer.android.com/reference/org/json/package-summary.html">Android Developers - org.json</a></li>
  <li><a href="http://developer.android.com/reference/android/widget/ArrayAdapter.html">Android Developers - ArrayAdapter</a></li>
  <li><a href="https://android.googlesource.com/platform/frameworks/base/+/master/core/java/android/widget/ArrayAdapter.java">Android Framework 에 있는 ArrayAdapter 소스코드</a></li>
  <li><a href="http://square.github.io/okhttp/">OkHttp</a></li>
  <li><a href="http://helloworld.naver.com/helloworld/textyle/377316">hello world » Android의 HTTP 클라이언트 라이브러리</a></li>
</ul>


          <!-- 구글플러스 +1 버튼 -->
          <!-- +1 버튼을(를) 표시하고 싶은 위치에 이 태그를 배치하세요. -->
          <br><br><div class="g-plusone"></div><br>
          <!-- Facebook 좋아요 버튼 -->
          <div class="fb-like" data-href="" data-layout="button_count"
           data-action="like" data-show-faces="true" data-share="false"></div><br>
          <br>
          
         <a class="card-content" href="/blog/tags/#develop">
             <button class="mdl-button mdl-js-button mdl-js-ripple-effect">#develop</button> </a>
         
         <a class="card-content" href="/blog/tags/#development">
             <button class="mdl-button mdl-js-button mdl-js-ripple-effect">#development</button> </a>
         
         <a class="card-content" href="/blog/tags/#android">
             <button class="mdl-button mdl-js-button mdl-js-ripple-effect">#android</button> </a>
         
         <a class="card-content" href="/blog/tags/#app">
             <button class="mdl-button mdl-js-button mdl-js-ripple-effect">#app</button> </a>
         
         <a class="card-content" href="/blog/tags/#study">
             <button class="mdl-button mdl-js-button mdl-js-ripple-effect">#study</button> </a>
         
         <a class="card-content" href="/blog/tags/#note">
             <button class="mdl-button mdl-js-button mdl-js-ripple-effect">#note</button> </a>
         
</section>
         </div>

         <div class="mdl-card mdl-cell mdl-cell--12-col postcard content" align="start">
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 블로그 포스트 광고 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-7051197638651710"
     data-ad-slot="3015305584"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

                  </div>


         <div class="mdl-card mdl-cell mdl-cell--12-col postcard content" align="start">
           

                  <table>
                    <a style="color:black;" href="/blog//2014/12/30/android-study-lesson-one-note.html" ><h4>시온고 안드로이드 스터디 노트 - 1.Create Project Sunshine</h4></a>
                    <tr><td><i class="material-icons">today</i></td><td>2014.12.30</td></tr></table>
                  
                  
                  <a style="color:black;" href="/blog//2015/01/11/android-study-lesson-three-note.html"><h4>시온고 안드로이드 스터디 노트 - 3.New Activities And Intents</h4></a>
                  <table><tr><td><i class="material-icons">today</i></td><td>2015.01.11</td></tr></table>
                  
                  </div>

                  <div class="mdl-card mdl-cell mdl-cell--12-col postcard content" align="start">
                 <!--COMMENT-->
         <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'youngbinhan'; // required: replace example with your forum shortname
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</div><br><br>
                           </div>

  </div>
  </main>

</div>

<script src="/blog/js/material.min.js"></script>
<script src="/blog/js/common.js"></script>
        <script>
var $buoop = {c:2};
function $buo_f(){
 var e = document.createElement("script");
 e.src = "//browser-update.org/update.js";
 document.body.appendChild(e);
};
try {document.addEventListener("DOMContentLoaded", $buo_f,false)}
catch(e){window.attachEvent("onload", $buo_f)}
</script>

    </body>
</html>
