<!DOCTYPE html>
<html>
<head>
    
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>SimpleCV 로 움직임 감지하기 | Youngbin Han</title>
  <meta name="description" content="SimpleCV를 이용하면 어렴지 않게 카메라를 통해 움직임을 감지해 낼 수 있습니다.복잡한 것은 SimpleCV가 거의 다 해주니 우리는 제공되는 API를 잘 활용하면, 금방 만들어 낼 수 있습니다.이 글은 여러분들이 이미 SimpleCV를 설치 하셨다는 가정 하에 쓴 글 입니다...">
<!--        Jquery-->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46663268-3', 'auto');
  ga('send', 'pageview');

</script>

<link rel="stylesheet" href="/blog/css/material.min.css">
<link rel="stylesheet" href="/blog/css/font-awesome.min.css">
  <link rel="stylesheet" href="/blog/css/custom.css">
  <link rel="canonical" href="http://sukso96100.github.io//blog/2014/11/08/detecting-motion-with-simplecv.html">
  <link rel="alternate" type="application/rss+xml" title="Youngbin Han" href="http://sukso96100.github.io//blog/feed.xml" />

<!--Browser Update Notification-->
<script>
var $buoop = {c:2};
function $buo_f(){
 var e = document.createElement("script");
 e.src = "https://browser-update.org/update.js";
 document.body.appendChild(e);
};
try {document.addEventListener("DOMContentLoaded", $buo_f,false)}
catch(e){window.attachEvent("onload", $buo_f)}
</script>

<link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">

    </head>
    <body>

    <div class="demo-layout-transparent mdl-layout mdl-js-layout">
  <header class="mdl-layout__header mdl-layout__header--transparent">
    <div class="mdl-layout__header-row">
      <!-- Title -->
      <span class="mdl-layout-title">Youngbin Han</span>
      <!-- Add spacer, to align navigation to the right -->
      <div class="mdl-layout-spacer"></div>
      <!-- Navigation -->
      <nav class="mdl-navigation">

      </nav>
    </div>
  </header>
  <div class="mdl-layout__drawer">
    <span class="mdl-layout-title">MENU</span>
    <nav class="mdl-navigation">
      <a class="mdl-navigation__link" href="">Link</a>
      <a class="mdl-navigation__link" href="">Link</a>
      <a class="mdl-navigation__link" href="">Link</a>
      <a class="mdl-navigation__link" href="">Link</a>
    </nav>
  </div>
  <main class="mdl-layout__content">
    <div align="center">
    <div class="mdl-card mdl-cell mdl-cell--12-col postcard" align="start">
           <div class="mdl-card__media mdl-color-text--grey-50"
           style="
           padding:16px;">
             <a href="/blog/"><h3 style="color:white;">SimpleCV 로 움직임 감지하기</h3></a>
           </div>
           <section class="content">
           <table><tr><td><i class="material-icons">today</i></td><td>2014.11.08</td></tr></table>
           <hr>
          <p>SimpleCV를 이용하면 어렴지 않게 카메라를 통해 움직임을 감지해 낼 수 있습니다.
복잡한 것은 SimpleCV가 거의 다 해주니 우리는 제공되는 API를 잘 활용하면, 금방 만들어 낼 수 있습니다.
이 글은 여러분들이 이미 SimpleCV를 설치 하셨다는 가정 하에 쓴 글 입니다. 아직 설치 하지 않으셨다면.
<a href="http://www.youngbin.tk/tutorial/python/simplecv/develop/development/raspberry-pi/linux/computer-vision/2014/11/02/how-to-install-simplecv-framework/">먼저 설치를 먼저 하신 다음,</a> 이 글을 보시는 것이 좋습니다.</p>

<h2 id="section">움직임을 감지하는 과정</h2>
<p>먼저 움직임을 감지하는 과정을 생각 해 봅시다. 움직임을 감지하려면, 사진 두 장을 얻어 차이를 봐야 합니다.
같은 장소, 같은 카메라에서, 비슷한 시간에 초 또는 분 간격으로 시간차이를 두고 찍혔는대.
두 사진 사이 차이가 있다면, 사진에 찍힌 것들이 움직여서 차이가 있는 것 이겠죠?
그렇다면 아래와 같이 감지 방법을 생각해 볼 수 있습니다.</p>

<ol>
  <li>임계값을 정한다, 두 사진 사이 다른 정도를 비교해서, 움직임 감지 기준으로 사용할 값이다.</li>
  <li>카메라에서 사진 하나 얻어서 기준 이미지로 정한다.</li>
  <li>사진 하나를 더 얻는다.</li>
  <li>기준 이미지와 추가로 얻은 이미지를 비교한다.</li>
  <li>비교했을 때, 다른 정도가 정해진 것 보다 크다면, 움직임을 감지한 것으로 인식한다
    <ul>
      <li>추가로 얻은 이미지를 새로운 기준 이미지로 정한다</li>
      <li>“2.” 부터 다시 반복한다</li>
    </ul>
  </li>
  <li>비교했을 때, 다른 정도가 정해진 것 보다 작다면, “2.” 부터 다시 반복한다</li>
</ol>

<h2 id="section-1">코드로 작성해 보기</h2>
<p>위 과정들을 한번 코드로 옮겨 봅시다.</p>

<p>먼저 필요한 모듈들을 임포트(import) 합시다.
여기서는 SimpleCV의 모듈들을 모두 임포트 합니다.
한글 입력이 필요한 경우 인코딩도 지정합시다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#-*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">SimpleCV</span> <span class="kn">import</span> <span class="o">*</span></code></pre></figure>

<p>그 다음, 움직임 감지 여부 기준으로 쓸, 임계값을 정합시다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#임계값</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mf">1.0</span></code></pre></figure>

<p>카메라를 초기화 하고, 이미지 하나를 얻어, 기준 이미지로 정합시다.
기준 이미지 이름은 “refImg” 로 정해봅시다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#카메라 초기화</span>
<span class="n">cam</span> <span class="o">=</span> <span class="n">Camera</span><span class="p">()</span>

<span class="c">#카메라에서 이미지 얻어 기준 이미지로 정하기</span>
<span class="k">print</span> <span class="s">"기준 이미지 얻는중"</span>
<span class="n">refImg</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">getImage</span><span class="p">()</span></code></pre></figure>

<p>아래는 기준 이미지 예시 입니다.<br />
(출처 : http://tutorial.simplecv.org/en/latest/examples/image-math.html#image-arithmetic)<br />
<img class="image-wrapper" src="http://sukso96100.github.io//blogimgs/image-math-person1.png" /><br /></p>

<p>기준 이미지와 비교할 이미지를 하나 더 얻습니다.
추가로 얻은 이미지를 “img” 라고 정합시다. 그리고 기준 이미지와의 차이를 얻어 봅시다.
단순히 5와 2의 차이를 “5 - 2”로 계산하듯, “기준이미지 - 새 이미지” 로 차이를 얻으면 됩니다.
그럼 여기선, “refImg - img” 로 하면 되죠. 두 이미지 사이에서 얻은 차이는 diff 로 정합시다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#새 이미지 얻기</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">getImage</span><span class="p">()</span>
<span class="c">#두 이미지 사이 차이 얻기</span>
<span class="n">diff</span> <span class="o">=</span> <span class="n">refImg</span> <span class="o">-</span> <span class="n">img</span></code></pre></figure>

<p>아래는 추가로 얻은 이미지 예시 입니다.<br />
(출처 : http://tutorial.simplecv.org/en/latest/examples/image-math.html#image-arithmetic)<br />
<img class="image-wrapper" src="http://sukso96100.github.io//blogimgs/image-math-person2.png" /><br /></p>

<p>기준 이미지에서, 추가로 얻은 이미지 사이 차이를 나타낸 이미지 예시 입니다.<br />
(출처 : http://tutorial.simplecv.org/en/latest/examples/image-math.html#image-arithmetic)<br />
<img class="image-wrapper" src="http://sukso96100.github.io//blogimgs/image-math-person-sub.png" /><br /></p>

<p>diff 이미지에는 차이가 있는 부분만 나타나는대, 그것을 수치상으로 표현해서.
처음에 정한 임계값과 비교해 봅시다. 임계값 보다 크면, 기준 이미지를 갱신하고,
그렇치 않으면 기준 이미지를 그대로 유지해 봅시다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#getNumpy()는 이미지를 다차원 배열로 나타냄</span>
<span class="c">#getNumpy().mean() 은 getNumpy()로 얻은 다차원 배열을 실수로 나타냄</span>
<span class="k">if</span> <span class="n">imgmath</span><span class="o">.</span><span class="n">getNumpy</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
  <span class="c">#차이가 임계값 보다 크면</span>
  <span class="k">print</span> <span class="s">"움직임 감지됨"</span>
  <span class="c">#기준 이미지 갱신</span>
  <span class="n">refImg</span> <span class="o">=</span> <span class="n">img</span>
  <span class="k">print</span> <span class="s">"기준 이미지 갱신"</span>
  <span class="k">print</span> <span class="s">"갱신시각"</span> <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">"</span><span class="si">%</span><span class="s">H:</span><span class="si">%</span><span class="s">M:</span><span class="si">%</span><span class="s">S"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
  <span class="c">#그렇치 않다면</span>
  <span class="k">print</span> <span class="s">"기준 이미지와 큰 차이 없음 기준 이미지 유지"</span></code></pre></figure>

<p>대략적인 코드가 다 짜여 졌군요. 위 코드를 다 이으면 완전한 코드가 완성 되지만.
이미지를 지속적으로 얻어서 비교하지 못하는 코드가 됩니다. 한번만 비교하고 끝나기 때문입나다.
추가로 이미지를 얻는 부분부터 끝까지, 무한 반목을 감싸서 프로그램이 종료 될때까지 계속 움직임을 인식하도록 해 봅시다.
그리고 화면에 카메라에서 얻은 이미지도 계속 표시해 봅시다.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#무한 반복</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="c">#새 이미지 얻기</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">getImage</span><span class="p">()</span>
    <span class="c"># show()는 이미지를 화면상에 보여줍니다.</span>
    <span class="n">img</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c">#기준 이미지와 새 이미지 사이 차이 얻기</span>
    <span class="n">imgmath</span> <span class="o">=</span> <span class="n">refImg</span> <span class="o">-</span> <span class="n">img</span>
    <span class="c">#getNumpy()는 이미지를 다차원 배열로 나타냄</span>
    <span class="c">#getNumpy().mean() 은 getNumpy()로 얻은 다차원 배열을 실수로 나타냄</span>
    <span class="k">if</span> <span class="n">imgmath</span><span class="o">.</span><span class="n">getNumpy</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
        <span class="c">#차이가 임계값 보다 크면</span>
        <span class="k">print</span> <span class="s">"움직임 감지됨"</span>
        <span class="c">#기준 이미지 갱신</span>
        <span class="n">refImg</span> <span class="o">=</span> <span class="n">img</span>
        <span class="k">print</span> <span class="s">"기준 이미지 갱신"</span>
        <span class="k">print</span> <span class="s">"갱신시각"</span> <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">"</span><span class="si">%</span><span class="s">H:</span><span class="si">%</span><span class="s">M:</span><span class="si">%</span><span class="s">S"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c">#그렇치 않다면</span>
        <span class="k">print</span> <span class="s">"기준 이미지와 큰 차이 없음 기준 이미지 유지"</span></code></pre></figure>

<p>이제 다 되었습니다. 완성된 코드는 아래와 같습니다.
저장 하신 후 한번 실행 해 보세요.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#-*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">SimpleCV</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c">#임계값</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="c">#카메라 초기화</span>
<span class="n">cam</span> <span class="o">=</span> <span class="n">Camera</span><span class="p">()</span>

<span class="c">#카메라에서 이미지 얻어 기준 이미지로 정하기</span>
<span class="k">print</span> <span class="s">"기준 이미지 얻는중"</span>
<span class="n">refImg</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">getImage</span><span class="p">()</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="c">#새 이미지 얻기</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">getImage</span><span class="p">()</span>
    <span class="c"># show()는 이미지를 화면상에 보여줍니다.</span>
    <span class="n">img</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c">#기준 이미지와 새 이미지 사이 차이 얻기</span>
    <span class="n">imgmath</span> <span class="o">=</span> <span class="n">refImg</span> <span class="o">-</span> <span class="n">img</span>
    <span class="c">#getNumpy()는 이미지를 다차원 배열로 나타냄</span>
    <span class="c">#getNumpy().mean() 은 getNumpy()로 얻은 다차원 배열을 실수로 나타냄</span>
    <span class="k">if</span> <span class="n">imgmath</span><span class="o">.</span><span class="n">getNumpy</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
        <span class="c">#차이가 임계값 보다 크면</span>
        <span class="k">print</span> <span class="s">"움직임 감지됨"</span>
        <span class="c">#기준 이미지 갱신</span>
        <span class="n">refImg</span> <span class="o">=</span> <span class="n">img</span>
        <span class="k">print</span> <span class="s">"기준 이미지 갱신"</span>
        <span class="k">print</span> <span class="s">"갱신시각"</span> <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">"</span><span class="si">%</span><span class="s">H:</span><span class="si">%</span><span class="s">M:</span><span class="si">%</span><span class="s">S"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c">#그렇치 않다면</span>
        <span class="k">print</span> <span class="s">"기준 이미지와 큰 차이 없음 기준 이미지 유지"</span></code></pre></figure>



          <!-- 구글플러스 +1 버튼 -->
          <!-- +1 버튼을(를) 표시하고 싶은 위치에 이 태그를 배치하세요. -->
          <br><br><div class="g-plusone"></div><br>
          <!-- Facebook 좋아요 버튼 -->
          <div class="fb-like" data-href="" data-layout="button_count"
           data-action="like" data-show-faces="true" data-share="false"></div><br>
          <br>
          
         <a class="card-content" href="/blog/tags/#tutorial">
             <button class="mdl-button mdl-js-button mdl-js-ripple-effect">#tutorial</button> </a>
         
         <a class="card-content" href="/blog/tags/#python">
             <button class="mdl-button mdl-js-button mdl-js-ripple-effect">#python</button> </a>
         
         <a class="card-content" href="/blog/tags/#simplecv">
             <button class="mdl-button mdl-js-button mdl-js-ripple-effect">#simplecv</button> </a>
         
         <a class="card-content" href="/blog/tags/#develop">
             <button class="mdl-button mdl-js-button mdl-js-ripple-effect">#develop</button> </a>
         
         <a class="card-content" href="/blog/tags/#development">
             <button class="mdl-button mdl-js-button mdl-js-ripple-effect">#development</button> </a>
         
         <a class="card-content" href="/blog/tags/#raspberry-pi">
             <button class="mdl-button mdl-js-button mdl-js-ripple-effect">#raspberry-pi</button> </a>
         
         <a class="card-content" href="/blog/tags/#linux">
             <button class="mdl-button mdl-js-button mdl-js-ripple-effect">#linux</button> </a>
         
         <a class="card-content" href="/blog/tags/#computer-vision">
             <button class="mdl-button mdl-js-button mdl-js-ripple-effect">#computer-vision</button> </a>
         
         <a class="card-content" href="/blog/tags/#motion">
             <button class="mdl-button mdl-js-button mdl-js-ripple-effect">#motion</button> </a>
         
</section>
         </div>

         <div class="mdl-card mdl-cell mdl-cell--12-col postcard content" align="start">
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 블로그 포스트 광고 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-7051197638651710"
     data-ad-slot="3015305584"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

                  </div>


         <div class="mdl-card mdl-cell mdl-cell--12-col postcard content" align="start">
           

                  <table>
                    <a style="color:black;" href="/blog//2014/11/02/how-to-install-simplecv-framework.html" ><h4>SimpleCV 설치하고 테스트 해 보기.</h4></a>
                    <tr><td><i class="material-icons">today</i></td><td>2014.11.02</td></tr></table>
                  
                  
                  <a style="color:black;" href="/blog//2014/12/13/install-and-configure-oracle-jdk-in-fedora.html"><h4>Fedora 에서 Oracle JDK 설치하고 설정하기</h4></a>
                  <table><tr><td><i class="material-icons">today</i></td><td>2014.12.13</td></tr></table>
                  
                  </div>

                  <div class="mdl-card mdl-cell mdl-cell--12-col postcard content" align="start">
                 <!--COMMENT-->
         <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'youngbinhan'; // required: replace example with your forum shortname
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</div><br><br>
                           </div>

  </div>
  </main>

</div>

<script src="/blog/js/material.min.js"></script>
<script src="/blog/js/common.js"></script>
        <script>
var $buoop = {c:2};
function $buo_f(){
 var e = document.createElement("script");
 e.src = "//browser-update.org/update.js";
 document.body.appendChild(e);
};
try {document.addEventListener("DOMContentLoaded", $buo_f,false)}
catch(e){window.attachEvent("onload", $buo_f)}
</script>

    </body>
</html>
